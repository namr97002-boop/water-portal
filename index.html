<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <link rel="manifest" href="manifest.json">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Ù†Ø¸Ø§Ù… Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ - Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ© 2026">
    <meta name="author" content="Ø§Ù„Ø£Ø³ØªØ§Ø° Ù†ØµØ± Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠ">
    <title>ğŸ’§ Ù†Ø¸Ø§Ù… Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ - Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙÙˆØ±ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</title>
    
    <!-- ========== Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ========== -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23030814'/><text x='50' y='65' font-size='40' text-anchor='middle' fill='%234cc9f0'>ğŸ’§</text></svg>">
    
    <!-- Ø¯Ø¹Ù… iOS Ùˆ Android -->
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23030814'/><text x='50' y='65' font-size='40' text-anchor='middle' fill='%234cc9f0'>ğŸ’§</text></svg>">
    <meta name="apple-mobile-web-app-title" content="ğŸ’§ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4cc9f0">
    <!-- ========== Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª ========== -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ============= Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ============= */
        :root {
            --primary: #4cc9f0;
            --accent: #00b4d8;
            --deep: #03045e;
            --gold: #ffb703;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§Ø®Ø±Ø© */
        .splash {
            position: fixed;
            inset: 0;
            background: #000814;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ ... -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* ============= Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ============= *//
        :root {
            --primary: #4cc9f0;
            --accent: #00b4d8;
            --deep: #03045e;
            --gold: #ffb703;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙØ§Ø®Ø±Ø© */
        .splash {
            position: fixed;
            inset: 0;
            background: #000814;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ù‚Ø·Ø±Ø© Ø§Ù„Ù†Ø§Ø¨Ø¶Ø© Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
        .drop-zone {
            position: relative;
            width: 120px;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        .main-drop {
            font-size: 80px;
            color: var(--primary);
            filter: drop-shadow(0 0 20px var(--primary));
            z-index: 5;
            animation: pulse-drop 2s ease-in-out infinite;
        }

        .drop-ring {
            position: absolute;
            border: 2px solid var(--primary);
            border-radius: 50%;
            animation: ripple-out 2s linear infinite;
        }

        @keyframes pulse-drop {
            0%, 100% { transform: scale(1); filter: brightness(1); }
            50% { transform: scale(1.1); filter: brightness(1.3) drop-shadow(0 0 40px var(--primary)); }
        }

        @keyframes ripple-out {
            0% { width: 40px; height: 40px; opacity: 1; }
            100% { width: 150px; height: 150px; opacity: 0; }
        }

        /* Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø²Ø¬Ø§Ø¬ÙŠØ© */
        .login-card {
            width: 420px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            text-align: center;
            box-shadow: 0 40px 100px rgba(0,0,0,0.6);
            position: relative;
            overflow: hidden;
        }

        .login-card::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, transparent, var(--primary), transparent);
            animation: rotate-border 6s linear infinite;
            z-index: -1;
        }

        @keyframes rotate-border {
            100% { transform: rotate(360deg); }
        }

        .card-inner {
            background: #001219;
            border-radius: 45px;
            padding: 30px;
        }

        /* Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-time-date {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 15px;
            margin: 20px 0;
            color: white;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .time-display {
            font-size: 36px;
            font-weight: 900;
            color: white;
            text-shadow: 0 0 15px var(--primary);
            letter-spacing: 2px;
            font-family: 'Tajawal', monospace;
            margin-bottom: 5px;
            direction: ltr;
        }

        .date-display {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .date-display i {
            color: var(--primary);
            font-size: 14px;
        }

/* Ø­Ù‚ÙˆÙ‚ Ø§Ù„ØªØµÙ…ÙŠÙ… - Ù†ØµØ± Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠ */
.designer-signature {
    margin-top: 25px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.designer-label {
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--accent);
    display: block;
}

.designer-name {
    font-size: 20px;
    font-weight: 900;
    /* ØªØ¯Ø±Ø¬ Ø°Ù‡Ø¨ÙŠ Ø¨ÙŠÙ† Ø§Ù„Ø£ØµÙØ± Ø§Ù„Ø°Ù‡Ø¨ÙŠ ÙˆØ§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ø§Ù„Ù†Ø­Ø§Ø³ÙŠ */
    background: linear-gradient(to bottom, #FFD700, #FFA500, #B8860B);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}
/* Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø³ÙŠØ¬Ø¹Ù„ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ø°Ù‡Ø¨ÙŠ Ù…Ø«Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ØµÙ…Ù… */
.login-header h1, .splash h1 {
    font-size: 28px; /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
    font-weight: 900;
    background: linear-gradient(to bottom, #FFD700, #FFA500, #B8860B);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    text-align: center;
    margin-bottom: 20px;
}


        /* Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø± */
        .input-group { margin: 25px 0; }
        
        input {
            width: 100%;
            padding: 18px;
            border-radius: 20px;
            border: 1px solid var(--accent);
            background: rgba(0,0,0,0.5);
            color: white;
            font-size: 22px;
            text-align: center;
            outline: none;
            transition: 0.4s;
        }

        input:focus { border-color: var(--gold); box-shadow: 0 0 15px var(--accent); }

        .btn-enter {
            width: 100%;
            padding: 18px;
            border-radius: 20px;
            border: none;
            background: linear-gradient(135deg, var(--deep), var(--accent));
            color: white;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
        }

        .btn-enter:hover { transform: translateY(-3px); box-shadow: 0 10px 30px var(--accent); }

        /* Ø´Ø±ÙŠØ· Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙŠ ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .status-bar {
            position: absolute;
            top: 25px;
            width: 90%;
            display: flex;
            justify-content: space-between;
            padding: 0 5%;
        }

        .status-item {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(10px);
        }

        /* Ø§Ù„Ø¬Ø²ÙŠØ¦Ø§Øª Ø§Ù„Ø¹Ø§Ø¦Ù…Ø© */
        .particle {
            position: absolute;
            background: white;
            border-radius: 50%;
            opacity: 0.3;
            animation: float 10s infinite linear;
        }

        @keyframes float {
            from { transform: translateY(100vh) scale(0); }
            to { transform: translateY(-10vh) scale(1); }
        }

        /* ============= Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ù…Ø®ØªÙ„ÙØ© ============= */
        [data-theme="normal"] {
            /* Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ (Ø§Ù„Ø¥ÙØªØ±Ø§Ø¶ÙŠ) */
            --primary: #0077b6;
            --secondary: #00b4d8;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
            --header-blue1: #1a237e;
            --header-blue2: #283593;
            --footer-orange: #ff9800;
 
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø®Ù„ÙÙŠØ© */
            --bg-primary: #f5f7fa;
            --bg-secondary: #e4e8f0;
            --bg-card: #ffffff;
            --bg-table: #ffffff;
            --bg-control: #ffffff;
            --bg-input: #f8f9fa;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ */
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-muted: #999999;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø­Ø¯ÙˆØ¯ */
            --border-color: #e0e0e0;
            --border-focus: #667eea;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
            --col1-color: #E3F2FD;
            --col2-color: #F8F9FA;
            --col3-color: #E8F5E9;
            --col4-color: #FFF3E0;
            --col5-color: #F3E5F5;
            --col6-color: #E0F7FA;
            --col7-color: #F1F8E9;
            --col8-color: #FFF8E1;
            --col9-color: #E8F5E9;
            --col10-color: #EDE7F6;
            --col11-color: #E1F5FE;
            --col12-color: #E8F5E9;
            --col13-color: #FFEBEE;
            --col14-color: #F3E5F5;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø­Ø³Ù†Ø© */
            --text-col1: #0D47A1;
            --text-col2: #000000;
            --text-col3: #1B5E20;
            --text-col4: #E65100;
            --text-col5: #4A148C;
            --text-col6: #006064;
            --text-col7: #33691E;
            --text-col8: #FF6F00;
            --text-col9: #1B5E20;
            --text-col10: #4A148C;
            --text-col11: #01579B;
            --text-col12: #1B5E20;
            --text-col13: #C2185B;
            --text-col14: #4A148C;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© */
            --chart-blue: #667eea;
            --chart-purple: #764ba2;
            --chart-green: #00b09b;
            --chart-yellow: #ffd200;
            --chart-red: #ff416c;
            --chart-orange: #f7971e;
            
            /* Ù„ÙˆÙ† Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
            --alert-red: #ff4757;
            --alert-red-light: #ff6b81;
            --alert-red-dark: #ff3838;
            
            /* Ø£Ù„ÙˆØ§Ù† AI Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
            --ai-purple: #8a2be2;
            --ai-teal: #20b2aa;
            --ai-green: #32cd32;
            --ai-blue: #1e90ff;
            --ai-orange: #ff8c00;
            
            /* Ø§Ù„Ø¸Ù„Ø§Ù„ */
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.15);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.2);
            --shadow-xl: 0 20px 50px rgba(0,0,0,0.3);
            
            /* Ø§Ù„ØªØ¯Ø±Ø¬Ø§Øª */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            --gradient-danger: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
            --gradient-warning: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            --gradient-ai: linear-gradient(135deg, var(--ai-purple) 0%, #9370db 100%);
        }

        /* ============= Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ù„ÙŠÙ„ÙŠ ============= */
        [data-theme="night"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-table: #1e293b;
            --bg-control: #334155;
            --bg-input: #334155;
            
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            
            --border-color: #475569;
            --border-focus: #60a5fa;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
            --col1-color: #1e3a8a;
            --col2-color: #1e293b;
            --col3-color: #064e3b;
            --col4-color: #78350f;
            --col5-color: #4c1d95;
            --col6-color: #0e7490;
            --col7-color: #365314;
            --col8-color: #713f12;
            --col9-color: #064e3b;
            --col10-color: #4c1d95;
            --col11-color: #0c4a6e;
            --col12-color: #064e3b;
            --col13-color: #831843;
            --col14-color: #4c1d95;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
            --text-col1: #93c5fd;
            --text-col2: #f8fafc;
            --text-col3: #86efac;
            --text-col4: #fdba74;
            --text-col5: #c4b5fd;
            --text-col6: #67e8f9;
            --text-col7: #bef264;
            --text-col8: #fbbf24;
            --text-col9: #86efac;
            --text-col10: #c4b5fd;
            --text-col11: #7dd3fc;
            --text-col12: #86efac;
            --text-col13: #f9a8d4;
            --text-col14: #c4b5fd;
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.4);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.5);
            --shadow-xl: 0 20px 50px rgba(0,0,0,0.6);
        }

        /* ============= Ø§Ù„Ù†Ù…Ø· Ø§Ù„Ø¯Ø§ÙƒÙ† ============= */
        [data-theme="dark"] {
            --bg-primary: #000000;
            --bg-secondary: #111827;
            --bg-card: #111827;
            --bg-table: #111827;
            --bg-control: #374151;
            --bg-input: #374151;
            
            --text-primary: #ffffff;
            --text-secondary: #d1d5db;
            --text-muted: #9ca3af;
            
            --border-color: #4b5563;
            --border-focus: #3b82f6;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --col1-color: #1e3a8a;
            --col2-color: #111827;
            --col3-color: #064e3b;
            --col4-color: #78350f;
            --col5-color: #4c1d95;
            --col6-color: #0e7490;
            --col7-color: #365314;
            --col8-color: #713f12;
            --col9-color: #064e3b;
            --col10-color: #4c1d95;
            --col11-color: #0c4a6e;
            --col12-color: #064e3b;
            --col13-color: #831843;
            --col14-color: #4c1d95;
            
            /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
            --text-col1: #60a5fa;
            --text-col2: #ffffff;
            --text-col3: #4ade80;
            --text-col4: #f97316;
            --text-col5: #a855f7;
            --text-col6: #22d3ee;
            --text-col7: #84cc16;
            --text-col8: #f59e0b;
            --text-col9: #4ade80;
            --text-col10: #a855f7;
            --text-col11: #0ea5e9;
            --text-col12: #4ade80;
            --text-col13: #ec4899;
            --text-col14: #a855f7;
            
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.4);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.5);
            --shadow-lg: 0 10px 30px rgba(0,0,0,0.6);
            --shadow-xl: 0 20px 50px rgba(0,0,0,0.7);
        }

        /* ============= Ø¥Ø¶Ø§ÙØ§Øª AI ============= */
        
        /* Ù„ÙˆØ­Ø© ØªØ­Ù„ÙŠÙ„ AI - Ø§Ù„Ø¢Ù† Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¥Ø®ÙØ§Ø¡ */
        .ai-analysis-card {
            background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 3px solid var(--ai-purple);
            box-shadow: var(--shadow-md);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .ai-analysis-card.hidden {
            display: none;
        }
        
        .ai-analysis-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--ai-purple), var(--ai-teal), var(--ai-blue));
        }
        
        .ai-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .ai-title {
            font-size: 22px;
            font-weight: 900;
            color: var(--ai-purple);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .ai-badge {
            background: var(--gradient-ai);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .ai-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .ai-stat-item {
            background: var(--bg-control);
            padding: 18px;
            border-radius: 12px;
            border-left: 5px solid var(--ai-teal);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .ai-stat-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
            border-left-color: var(--ai-purple);
        }
        
        .ai-stat-item.warning {
            border-left-color: var(--warning);
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2) 0%, rgba(255, 234, 167, 0.2) 100%);
        }
        
        .ai-stat-item.danger {
            border-left-color: var(--danger);
            background: linear-gradient(135deg, rgba(248, 215, 218, 0.2) 0%, rgba(245, 198, 203, 0.2) 100%);
        }
        
        .ai-stat-item.success {
            border-left-color: var(--success);
            background: linear-gradient(135deg, rgba(212, 237, 218, 0.2) 0%, rgba(195, 230, 203, 0.2) 100%);
        }
        
        .ai-stat-value {
            font-size: 28px;
            font-weight: 900;
            margin-bottom: 8px;
            color: var(--ai-purple);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .ai-stat-trend {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: bold;
            padding: 4px 10px;
            border-radius: 12px;
            background: rgba(138, 43, 226, 0.1);
            color: var(--ai-purple);
            width: fit-content;
        }
        
        .ai-stat-trend.up {
            background: rgba(40, 167, 69, 0.1);
            color: var(--success);
        }
        
        .ai-stat-trend.down {
            background: rgba(220, 53, 69, 0.1);
            color: var(--danger);
        }
        
        .ai-stat-trend.stable {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning);
        }
        
        /* ØªÙˆØµÙŠØ§Øª AI */
        .ai-recommendations {
            background: linear-gradient(135deg, rgba(240, 248, 255, 0.2) 0%, rgba(230, 247, 255, 0.2) 100%);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid var(--ai-blue);
            position: relative;
        }
        
        .ai-recommendations::before {
            content: 'ğŸ’¡';
            position: absolute;
            top: -15px;
            left: 20px;
            background: var(--ai-teal);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .ai-recommendations-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .ai-recommendations-header h3 {
            margin: 0;
            color: var(--ai-teal);
            font-weight: 900;
        }
        
        .ai-recommendations-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .ai-recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 15px;
            background: var(--bg-control);
            border-radius: 10px;
            border-right: 4px solid var(--ai-teal);
            transition: all 0.3s;
            position: relative;
        }
        
        .ai-recommendation-item:hover {
            transform: translateX(-5px);
            box-shadow: var(--shadow-sm);
        }
        
        .ai-recommendation-icon {
            width: 36px;
            height: 36px;
            background: var(--ai-teal);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .ai-recommendation-content {
            flex: 1;
        }
        
        .ai-recommendation-title {
            font-weight: bold;
            margin-bottom: 6px;
            color: var(--ai-teal);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-recommendation-desc {
            color: var(--text-secondary);
            font-size: 13px;
            line-height: 1.5;
        }
        
        .ai-priority-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            margin-right: 8px;
        }
        
        .priority-high {
            background: var(--danger);
            color: white;
        }
        
        .priority-medium {
            background: var(--warning);
            color: var(--text-primary);
        }
        
        .priority-low {
            background: var(--success);
            color: white;
        }
        
        /* ØªÙ†Ø¨ÙŠÙ‡Ø§Øª AI */
        .ai-alerts-section {
            margin-top: 20px;
        }
        
        .ai-alerts-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 71, 87, 0.2);
        }
        
        .ai-alerts-header h3 {
            margin: 0;
            color: var(--alert-red);
            font-weight: 900;
        }
        
        .ai-alerts-list {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }
        
        .ai-alert-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            margin-bottom: 10px;
            background: var(--bg-control);
            border-radius: 10px;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
            position: relative;
        }
        
        .ai-alert-item::before {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: var(--alert-red);
            border-radius: 0 10px 10px 0;
        }
        
        .ai-alert-item.warning::before {
            background: var(--warning);
        }
        
        .ai-alert-item.info::before {
            background: var(--info);
        }
        
        .ai-alert-item:hover {
            border-color: var(--alert-red);
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.1);
        }
        
        .ai-alert-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            flex-shrink: 0;
        }
        
        .ai-alert-icon.warning {
            background: rgba(255, 193, 7, 0.2);
            color: var(--warning);
        }
        
        .ai-alert-icon.danger {
            background: rgba(248, 215, 218, 0.2);
            color: var(--danger);
        }
        
        .ai-alert-icon.info {
            background: rgba(209, 236, 241, 0.2);
            color: var(--info);
        }
        
        .ai-alert-content {
            flex: 1;
        }
        
        .ai-alert-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .ai-alert-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        .ai-alert-time {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 5px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Ø²Ø± AI Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .btn-ai {
            background: var(--gradient-ai);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn-ai:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(138, 43, 226, 0.3);
        }
        
        .btn-ai-secondary {
            background: linear-gradient(135deg, var(--ai-teal), #20c997);
        }
        
        /* Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¸Ù‡ÙˆØ±/Ø§Ù„Ø¥Ø®ÙØ§Ø¡ Ù„Ù€ AI */
        .ai-toggle-btn {
            background: linear-gradient(135deg, var(--ai-blue), var(--ai-teal));
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            font-size: 13px;
            margin-right: 10px;
        }
        
        .ai-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(30, 144, 255, 0.3);
        }
        
        /* AI ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… */
        .ai-control-btn {
            position: relative;
        }
        
        .ai-badge-count {
            position: absolute;
            top: -8px;
            left: -8px;
            background: white;
            color: var(--ai-purple);
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 11px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            animation: badgePulse 2s infinite;
        }
        
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* ============= Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨ ============= */
        .smart-search-container {
            position: relative;
            flex: 2;
            min-width: 300px;
            margin-right: 15px;
        }
        
        .smart-search-box {
            position: relative;
            display: flex;
            align-items: center;
            background: var(--bg-input);
            border-radius: 50px;
            padding: 5px 20px;
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
        }
        
        .smart-search-box:focus-within {
            border-color: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
            background: white;
        }
        
        .smart-search-box input {
            width: 100%;
            padding: 12px 15px;
            border: none;
            background: transparent;
            font-size: 16px;
            transition: all 0.3s;
            color: var(--text-primary);
            font-family: 'Tajawal';
            text-align: right;
        }
        
        .smart-search-box input:focus {
            outline: none;
        }
        
        .smart-search-box input::placeholder {
            color: var(--text-muted);
        }
        
        .smart-search-box .search-icon {
            position: absolute;
            right: 15px;
            color: #667eea;
            font-size: 18px;
        }
        
        .smart-search-box button {
            background: transparent;
            border: none;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            border-radius: 50%;
            margin-left: 10px;
        }
        
        .smart-search-box button:hover {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .smart-search-box button.recording {
            background: rgba(220, 53, 69, 0.1);
            animation: recordingPulse 1.5s infinite;
        }
        
        .smart-search-box button .fa-microphone {
            color: #dc3545;
            font-size: 16px;
        }
        
        .pulse {
            width: 12px;
            height: 12px;
            background: #dc3545;
            border-radius: 50%;
            display: inline-block;
            animation: pulse-animation 1s infinite;
        }
        
        @keyframes pulse-animation {
            0% { 
                transform: scale(0.95); 
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); 
            }
            70% { 
                transform: scale(1); 
                box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); 
            }
            100% { 
                transform: scale(0.95); 
                box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); 
            }
        }
        
        @keyframes recordingPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ */
        .smart-search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .smart-search-results.show {
            display: block;
        }
        
        .search-result-header {
            padding: 15px 20px;
            background: var(--gradient-primary);
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .search-result-header h4 {
            margin: 0;
            font-size: 16px;
        }
        
        .search-result-count {
            background: white;
            color: var(--primary);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .search-result-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .search-result-item:hover {
            background: var(--bg-secondary);
        }
        
        .search-result-item.high-debt {
            border-right: 4px solid var(--danger);
        }
        
        .search-result-item.medium-debt {
            border-right: 4px solid var(--warning);
        }
        
        .search-result-info {
            flex: 1;
        }
        
        .search-result-name {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .search-result-details {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .search-result-debt {
            font-weight: bold;
            min-width: 100px;
            text-align: left;
        }
        
        .search-result-debt.high {
            color: var(--danger);
        }
        
        .search-result-debt.medium {
            color: var(--warning);
        }
        
        .search-result-debt.low {
            color: var(--success);
        }
        
        .no-search-results {
            padding: 30px 20px;
            text-align: center;
            color: var(--text-muted);
        }
        
        .no-search-results i {
            font-size: 40px;
            margin-bottom: 15px;
            color: var(--border-color);
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .smart-search-container {
                min-width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .smart-search-box {
                padding: 5px 15px;
            }
            
            .smart-search-box input {
                font-size: 14px;
                padding: 10px;
            }
            
            .smart-search-results {
                position: fixed;
                top: 60px;
                left: 10px;
                right: 10px;
                max-height: 300px;
            }
        }
        
        /* ØªØ£Ø«ÙŠØ±Ø§Øª AI */
        @keyframes pulseAI {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(138, 43, 226, 0.4);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 10px rgba(138, 43, 226, 0);
            }
        }
        
        .ai-pulse {
            animation: pulseAI 2s infinite;
        }
        
        /* ============= Ù†Ù‡Ø§ÙŠØ© Ø¥Ø¶Ø§ÙØ§Øª AI ÙˆØ§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ ============= */
        
        /* ============= Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ¶Ø¹ ============= */
        .theme-controls {
            position: fixed;
            bottom: 30px;
            right: 100px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            background: var(--bg-control);
            padding: 10px;
            border-radius: 15px;
            box-shadow: var(--shadow-lg);
            border: 2px solid var(--border-color);
        }
        
        .theme-btn {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
            background: var(--bg-input);
            color: var(--text-primary);
            position: relative;
            overflow: hidden;
        }
        
        .theme-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .theme-btn.active {
            border: 3px solid var(--primary);
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
        }
        
        .theme-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: currentColor;
            opacity: 0.1;
        }
        
        .theme-btn .fa-sun {
            color: #ffd700;
        }
        
        .theme-btn .fa-moon {
            color: #667eea;
        }
        
        .theme-btn .fa-star {
            color: #000000;
            background: linear-gradient(45deg, #000000, #333333);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .focus-mode-btn {
            width: auto;
            padding: 0 20px;
            font-size: 14px;
            font-weight: bold;
            background: var(--gradient-primary);
            color: white;
            display: flex;
            gap: 8px;
        }
        
        .focus-mode-btn:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4196 100%);
        }
        
        .focus-mode-btn.active {
            background: var(--gradient-success);
        }
        
        /* ============= ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² ============= */
        body.focus-mode .theme-controls {
            opacity: 1;
            transform: translateX(0);
        }

        body.focus-mode .theme-controls:hover {
            opacity: 1;
            transform: translateX(0);
        }

        body.focus-mode .focus-mode-btn {
            display: flex !important;
            background: var(--gradient-success) !important;
            color: white !important;
            z-index: 1001 !important;
            position: fixed !important;
            bottom: 30px !important;
            right: 30px !important;
        }

        body.focus-mode .control-bar,
        body.focus-mode .status-bar,
        body.focus-mode .ai-analysis-card,
        body.focus-mode .charts-section,
        body.focus-mode .developer-signature,
        body.focus-mode .sync-all-btn,
        body.focus-mode .chart-toggle-btn,
        body.focus-mode .ai-toggle-control {
            display: none !important;
        }

        body.focus-mode .app-container {
            padding: 10px;
            max-width: 100%;
        }

        body.focus-mode .table-container {
            max-height: calc(100vh - 20px);
            border-radius: 10px;
        }
        
        /* ============= Ø§Ø³ØªÙ…Ø±Ø§Ø± Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£ØµÙ„ÙŠØ© ============= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        /* Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .app-container {
            padding: 20px;
            max-width: 2000px;
            margin: 0 auto;
            transition: padding 0.3s ease;
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… */
        .control-bar {
            background: var(--gradient-primary);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            color: white;
            transition: all 0.3s ease;
        }
        
        .user-info {
            flex: 1;
            min-width: 200px;
        }
        
        .search-box {
            position: relative;
            flex: 2;
            min-width: 300px;
            display: none;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(255,255,255,0.9);
            font-size: 16px;
            transition: all 0.3s;
            color: #333;
        }
        
        .search-box input:focus {
            border-color: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
            outline: none;
            background: white;
        }
        
        .search-box i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #667eea;
            font-size: 18px;
        }
        
        select {
            padding: 12px 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 10px;
            background: rgba(255,255,255,0.9);
            font-size: 16px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }
        
        select:focus {
            border-color: white;
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3);
            outline: none;
            background: white;
        }
        
        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            transition: all 0.3s;
            font-size: 16px;
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: white;
        }
        
        .btn-danger {
            background: var(--gradient-danger);
            color: white;
        }
        
        .btn-warning {
            background: var(--gradient-warning);
            color: #333;
        }
        
        .btn-chart {
            background: linear-gradient(135deg, var(--chart-green) 0%, var(--chart-blue) 100%);
            color: white;
        }
        
        .btn-alert {
            background: linear-gradient(135deg, var(--alert-red) 0%, var(--alert-red-dark) 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        /* Ù‚Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© */
        .charts-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            display: none;
        }
        
        .charts-section.visible {
            display: grid;
        }
        
        .chart-container {
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
            min-height: 400px;
        }
        
        .chart-container:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chart-controls {
            display: flex;
            gap: 10px;
        }
        
        .chart-type-select {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background: var(--bg-input);
            font-family: 'Tajawal';
            font-size: 14px;
            color: var(--text-primary);
        }
        
        .chart-canvas-container {
            position: relative;
            height: 320px;
            width: 100%;
        }
        
        .chart-statistics {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border-color);
        }
        
        .chart-stat {
            text-align: center;
        }
        
        .chart-stat-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary);
        }
        
        .chart-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© */
        .sync-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--gradient-success);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            animation: slideIn 0.5s;
            box-shadow: var(--shadow-lg);
            font-weight: bold;
        }
        
        .sync-indicator.error {
            background: var(--gradient-danger);
        }
        
        .sync-indicator.warning {
            background: var(--gradient-warning);
            color: #333;
        }
        
        .sync-indicator.ai {
            background: var(--gradient-ai);
            color: white;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© */
        .status-bar {
            background: var(--bg-card);
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 25px;
            box-shadow: var(--shadow-md);
            flex-wrap: wrap;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 15px;
            background: var(--bg-control);
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
        }
        
        .status-dot.online {
            background: var(--gradient-success);
            animation: pulse 2s infinite;
        }
        
        .status-dot.syncing {
            background: var(--gradient-warning);
            animation: pulse 1s infinite;
        }
        
        .status-dot.ai {
            background: var(--gradient-ai);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ */
        .auto-month-indicator {
            background: var(--gradient-warning);
            color: #333;
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-md);
            font-weight: bold;
            animation: pulseMonth 3s infinite;
        }
        
        @keyframes pulseMonth {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ */
        .smart-loading {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
            gap: 20px;
        }
        
        .loading-content {
            text-align: center;
            padding: 40px;
            background: var(--bg-card);
            border-radius: 15px;
            box-shadow: var(--shadow-xl);
            max-width: 500px;
            width: 90%;
        }
        
        .spinner {
            font-size: 60px;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 20px;
            animation: spin 1.5s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© */
        .memory-management {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: var(--shadow-md);
            border: 2px solid #667eea;
        }
        
        .memory-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .memory-stat {
            background: var(--bg-control);
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: var(--shadow-sm);
            min-width: 180px;
        }
        
        .memory-stat-value {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .memory-stat-label {
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        /* Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
        .table-container {
            background: var(--bg-table);
            border-radius: 15px;
            overflow: auto;
            box-shadow: var(--shadow-lg);
            max-height: 70vh;
            position: relative;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1600px;
        }
        
        /* ØªÙ„ÙˆÙŠÙ† Ø±Ø¤ÙˆØ³ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
        thead th {
            background: var(--gradient-primary);
            color: white;
            padding: 18px 12px;
            position: sticky;
            top: 0;
            font-weight: bold;
            text-align: center;
            border-right: 1px solid rgba(255,255,255,0.2);
            z-index: 20;
            font-size: 16px;
        }
        
        /* ØªÙ„ÙˆÙŠÙ† Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…Ø®ØªÙ„ÙØ© */
        td:nth-child(1), th:nth-child(1) { 
            background: var(--col1-color) !important;
            color: var(--text-col1) !important;
            font-weight: bold;
        }
        
        td:nth-child(2), th:nth-child(2) { 
            background: var(--col2-color) !important;
            color: var(--text-col2) !important;
            font-weight: 900 !important;
            font-size: 16px !important;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        
        td:nth-child(3), th:nth-child(3) { 
            background: var(--col3-color) !important;
            color: var(--text-col3) !important;
            font-weight: 600;
        }
        
        td:nth-child(4), th:nth-child(4) { 
            background: var(--col4-color) !important;
            color: var(--text-col4) !important;
            font-weight: bold;
        }
        
        td:nth-child(5), th:nth-child(5) { 
            background: var(--col5-color) !important;
            color: var(--text-col5) !important;
            font-weight: 600;
        }
        
        td:nth-child(6), th:nth-child(6) { 
            background: var(--col6-color) !important;
            color: var(--text-col6) !important;
            font-weight: 600;
        }
        
        td:nth-child(7), th:nth-child(7) { 
            background: var(--col7-color) !important;
            color: var(--text-col7) !important;
            font-weight: bold;
        }
        
        td:nth-child(8), th:nth-child(8) { 
            background: var(--col8-color) !important;
            color: var(--text-col8) !important;
            font-weight: 600;
        }
        
        td:nth-child(9), th:nth-child(9) { 
            background: var(--col9-color) !important;
            color: var(--text-col9) !important;
            font-weight: 600;
        }
        
        td:nth-child(10), th:nth-child(10) { 
            background: var(--col10-color) !important;
            color: var(--text-col10) !important;
            font-weight: bold;
        }
        
        td:nth-child(11), th:nth-child(11) { 
            background: var(--col11-color) !important;
            color: var(--text-col11) !important;
            font-weight: 600;
        }
        
        td:nth-child(12), th:nth-child(12) { 
            background: var(--col12-color) !important;
            color: var(--text-col12) !important;
            font-weight: bold;
        }
        
        td:nth-child(13), th:nth-child(13) { 
            background: var(--col13-color) !important;
            color: var(--text-col13) !important;
            font-weight: bold;
        }
        
        td:nth-child(14), th:nth-child(14) { 
            background: var(--col14-color) !important;
            color: var(--text-col14) !important;
            font-weight: 600;
        }
        
        /* ØªØ¸Ù„ÙŠÙ„ Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ø§Ù„ØªÙŠ ØªØ²ÙŠØ¯ Ø¹Ù† 5000 */
        td.high-debt-cell {
            background: linear-gradient(135deg, var(--alert-red-light), var(--alert-red)) !important;
            color: white !important;
            font-weight: bold;
            animation: pulseRed 1.5s infinite;
            position: relative;
            box-shadow: 0 0 10px rgba(255, 71, 87, 0.3);
            border: 2px solid white;
        }
        
        td.high-debt-cell::after {
            content: '!';
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            font-weight: bold;
            background: white;
            color: var(--alert-red);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @keyframes pulseRed {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(255, 71, 87, 0.3); }
            50% { transform: scale(1.02); box-shadow: 0 0 20px rgba(255, 71, 87, 0.5); }
        }
        
        /* Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ */
        .row-0 td {
            background: linear-gradient(135deg, var(--header-blue1), var(--header-blue2)) !important;
            color: white !important;
            font-weight: bold;
            padding: 18px 12px;
            position: sticky;
            top: 58px;
            z-index: 15;
            border-bottom: 3px solid rgba(255,255,255,0.3);
            text-align: center;
            font-size: 16px;
        }
        
        .row-0 td:nth-child(2) {
            color: white !important;
            font-weight: 900;
        }
        
        /* Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ */
        .row-1 td {
            background: linear-gradient(135deg, var(--header-blue2), #3949ab) !important;
            color: white !important;
            font-weight: bold;
            padding: 18px 12px;
            position: sticky;
            top: 98px;
            z-index: 15;
            border-bottom: 3px solid rgba(255,255,255,0.3);
            text-align: center;
            font-size: 16px;
        }
        
        .row-1 td:nth-child(2) {
            color: white !important;
            font-weight: 900;
        }
        
        /* Ø§Ù„ØµÙ Ø§Ù„Ø£Ø®ÙŠØ± */
        .total-row td {
            background: linear-gradient(135deg, var(--footer-orange), #ffb74d) !important;
            color: white !important;
            font-weight: bold;
            padding: 18px 12px;
            position: sticky;
            bottom: 0;
            z-index: 15;
            border-top: 4px solid rgba(255,255,255,0.5);
            border-bottom: none;
            text-align: center;
            font-size: 16px;
        }
        
        .total-row td:nth-child(2) {
            color: white !important;
            font-weight: 900;
        }
        
        /* Ø¨Ø§Ù‚ÙŠ Ø§Ù„ØµÙÙˆÙ */
        tr:not(.row-0):not(.row-1):not(.total-row) td {
            padding: 15px 12px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            text-align: center;
            transition: all 0.3s;
            font-size: 15px;
        }
        
        tr:not(.row-0):not(.row-1):not(.total-row):hover td {
            filter: brightness(0.95);
        }
        
        /* Ø§Ù„Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ */
        .editable {
            background: white !important;
            border: 3px solid #667eea !important;
            cursor: text;
            position: relative;
        }
        
        .editable:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.2) !important;
            z-index: 10;
        }
        
        /* Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø¹Ø§Ù„ÙŠØ© Ù„Ù„ØµÙ ÙƒØ§Ù…Ù„ */
        .high-debt-row {
            background: linear-gradient(135deg, rgba(255, 71, 87, 0.1), rgba(255, 107, 129, 0.1)) !important;
            position: relative;
        }
        
        .high-debt-row::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: linear-gradient(to bottom, var(--alert-red), var(--alert-red-dark));
        }
        
        /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø­ÙØ¸ */
        .saving {
            background: #fff3cd !important;
            color: #333 !important;
        }
        
        .saved {
            animation: savedEffect 1.5s;
        }
        
        @keyframes savedEffect {
            0% { background: #d4edda !important; }
            100% { background: transparent !important; }
        }
        
        .unsaved-change {
            background: #fff3e0 !important;
            border: 2px dashed #ff9800 !important;
        }
        
        [v-cloak] {
            display: none;
        }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª */
        .alerts-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .alerts-container {
            background: var(--bg-card);
            border-radius: 20px;
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            animation: modalAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        @keyframes modalAppear {
            from { transform: scale(0.9) translateY(50px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .alerts-header {
            background: linear-gradient(135deg, var(--alert-red), var(--alert-red-dark));
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid rgba(255,255,255,0.2);
        }
        
        .alerts-header h2 {
            margin: 0;
            font-size: 24px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .close-alerts {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .close-alerts:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .alerts-stats {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .alert-stat {
            background: rgba(255,255,255,0.15);
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 150px;
        }
        
        .alert-stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .alert-stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .alerts-content {
            padding: 0;
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .alerts-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .alerts-table th {
            background: #f8f9fa;
            padding: 18px 15px;
            text-align: center;
            border-bottom: 2px solid #e0e0e0;
            font-weight: bold;
            color: var(--alert-red-dark);
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .alerts-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s;
        }
        
        .alerts-table tr:hover td {
            background: rgba(255, 107, 129, 0.05);
        }
        
        .debt-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            min-width: 100px;
        }
        
        .debt-badge.high {
            background: linear-gradient(135deg, var(--alert-red), var(--alert-red-dark));
            color: white;
        }
        
        .debt-badge.medium {
            background: linear-gradient(135deg, #f7971e, #ffd200);
            color: #333;
        }
        
        .debt-badge.low {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
        }
        
        .export-alerts-btn {
            margin: 20px auto;
            display: block;
            padding: 12px 30px;
        }
        
        .no-alerts {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .no-alerts i {
            font-size: 60px;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        /* Ø²Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙÙŠ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… */
        .alerts-btn-badge {
            position: absolute;
            top: -8px;
            left: -8px;
            background: white;
            color: var(--alert-red);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
            animation: badgePulse 2s infinite;
        }
        
        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ø¬ÙˆØ§Ù„ */
        @media (max-width: 768px) {
            .control-bar {
                flex-direction: column;
                align-items: stretch;
                padding: 15px;
            }
            
            .smart-search-container {
                min-width: 100%;
                margin-right: 0;
                margin-bottom: 10px;
            }
            
            .app-container {
                padding: 10px;
            }
            
            .status-bar, .memory-management {
                gap: 15px;
                padding: 12px;
            }
            
            .status-item, .memory-stat {
                flex: 1;
                min-width: 45%;
                justify-content: center;
            }
            
            .charts-section {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                min-height: 350px;
                padding: 15px;
            }
            
            .chart-canvas-container {
                height: 280px;
            }
            
            .row-0 td {
                top: 50px;
                font-size: 14px;
                padding: 14px 8px;
            }
            
            .row-1 td {
                top: 85px;
                font-size: 14px;
                padding: 14px 8px;
            }
            
            tr:not(.row-0):not(.row-1):not(.total-row) td {
                padding: 12px 8px;
                font-size: 14px;
            }
            
            thead th {
                padding: 14px 8px;
                font-size: 14px;
            }
            
            .alerts-container {
                width: 95%;
                margin: 10px;
            }
            
            .alerts-header {
                padding: 20px;
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .alerts-stats, .memory-stats {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .alert-stat, .memory-stat {
                min-width: 120px;
                flex: 1;
            }
            
            .theme-controls {
                bottom: 80px;
                right: 10px;
                flex-direction: column;
            }
            
            .theme-btn {
                width: 45px;
                height: 45px;
            }
            
            .focus-mode-btn {
                width: 45px;
                height: 45px;
                padding: 0;
                justify-content: center;
            }
            
            .focus-mode-btn span {
                display: none;
            }
        }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        .table-container::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }
        
        .table-container::-webkit-scrollbar-track {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            border-radius: 6px;
        }
        
        .table-container::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 6px;
        }
        
        .table-container::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4196 100%);
        }
        
        /* ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø·ÙˆØ± */
        .developer-signature {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            color: var(--text-secondary);
            font-size: 14px;
            background: rgba(255,255,255,0.8);
            border-radius: 10px;
            box-shadow: var(--shadow-sm);
        }
        
        .developer-signature i {
            color: #667eea;
            margin-left: 5px;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ */
        .current-month {
            background: var(--gradient-success) !important;
            color: white !important;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }
        
        .current-month::after {
            content: 'âœ“';
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
        }
        
        .month-indicator {
            display: inline-block;
            padding: 5px 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            margin-right: 10px;
        }
        
        /* Ø²Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ© */
        .sync-all-btn {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 100;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© */
        .cached-indicator {
            display: inline-block;
            padding: 3px 8px;
            background: #00bcd4;
            color: white;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 8px;
        }
        
        /* Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© */
        .chart-toggle-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 100;
        }
        
        /* Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù€ AI - ÙŠØ¸Ù‡Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ø²Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .ai-toggle-control {
            position: fixed;
            bottom: 90px;
            right: 30px;
            z-index: 100;
        }
        
        .chart-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: white;
            z-index: 2000;
            padding: 20px;
            overflow: auto;
        }
        
        .chart-fullscreen .chart-container {
            min-height: 600px;
        }
        
        .chart-fullscreen .chart-canvas-container {
            height: 500px;
        }
        
        .close-fullscreen {
            position: absolute;
            top: 20px;
            left: 20px;
            background: var(--danger);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            z-index: 10;
        }
        
        /* Ù…Ø¤Ø´Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø© */
        .memory-indicator {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin-top: 5px;
            overflow: hidden;
        }
        
        .memory-indicator-fill {
            height: 100%;
            background: var(--gradient-primary);
            transition: width 0.3s ease;
        }
        
        /* Ø²Ø± Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© */
        .memory-management-btn {
            padding: 8px 15px;
            background: var(--bg-input);
            border: 2px solid #667eea;
            border-radius: 8px;
            color: #667eea;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .memory-management-btn:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }
        
        /* ============= Ù†Ù…Ø· Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ ============= */
        .monthly-report-container {
            max-width: 1400px;
            margin: 20px auto;
            background: var(--bg-card);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow-lg);
        }
        
        .monthly-report-header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            text-align: center;
            box-shadow: var(--shadow-md);
        }
        
        .monthly-report-stats {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        
        .monthly-report-stat-box {
            background-color: rgba(255, 255, 255, 0.15);
            padding: 15px 20px;
            border-radius: 8px;
            min-width: 150px;
            backdrop-filter: blur(10px);
        }
        
        .monthly-report-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            background-color: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: var(--shadow-md);
        }
        
        .monthly-report-month-btn {
            padding: 10px 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Tajawal';
            transition: 0.3s;
            background: #e9ecef;
            margin: 2px;
            font-weight: 500;
        }
        
        .monthly-report-month-btn.active {
            background-color: var(--primary);
            color: white;
        }
        
        .monthly-report-month-btn.total-btn {
            background-color: #2c3e50;
            color: white;
        }
        
        .report-search-input {
            padding: 12px 40px 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            width: 300px;
            font-family: 'Tajawal';
            outline: none;
            transition: 0.3s;
            background: var(--bg-input);
            color: var(--text-primary);
        }
        
        .report-search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 5px rgba(0,119,182,0.2);
        }
        
        .report-table-wrapper {
            background: var(--bg-table);
            border-radius: 12px;
            overflow: auto;
            box-shadow: var(--shadow-md);
            max-height: 70vh;
        }
        
        .report-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1000px;
        }
        
        .report-table th {
            background: #4a6491;
            color: white;
            padding: 18px 15px;
            position: sticky;
            top: 0;
            z-index: 10;
            font-weight: bold;
        }
        
        .report-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }
        
        .report-total-row {
            background-color: #2c3e50 !important;
            color: white !important;
            font-weight: 800;
            position: sticky;
            bottom: 0;
            z-index: 5;
        }
        
        .report-total-row td {
            border-top: 2px solid rgba(255,255,255,0.1);
        }
        
        .report-positive {
            color: var(--success);
            font-weight: bold;
        }
        
        .report-negative {
            color: var(--danger);
            font-weight: bold;
        }
        
        .refresh-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 15px;
            font-family: 'Tajawal';
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .refresh-btn:hover {
            background-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.4s;
        }
        
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        .loading-overlay {
            text-align: center;
            padding: 60px;
            color: var(--text-muted);
        }
        
        /* Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ */
        .monthly-report-btn {
            position: fixed;
            bottom: 30px;
            right: 170px;
            z-index: 100;
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 12px 25px;
            border-radius: 10px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
            box-shadow: var(--shadow-md);
            transition: all 0.3s;
        }
        
        .monthly-report-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        /* Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ */
        .monthly-report-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            padding: 20px;
            backdrop-filter: blur(5px);
        }
        
        .monthly-report-modal-content {
            background: var(--bg-card);
            border-radius: 20px;
            width: 95%;
            max-width: 1600px;
            max-height: 95vh;
            overflow: hidden;
            box-shadow: var(--shadow-xl);
            animation: modalAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .report-modal-header {
            background: linear-gradient(135deg, #2c3e50, #4a6491);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid rgba(255,255,255,0.2);
        }
        
        .close-report-modal {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s;
        }
        
        .close-report-modal:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .report-modal-body {
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }
        /* --- Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³ÙŠÙ†Ù…Ø§Ø¦ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ --- */
body {
    background: linear-gradient(-45deg, #03045e, #023e8a, #0077b6, #1a237e) !important;
    background-size: 400% 400% !important;
    animation: gradientBG 15s ease infinite !important;
    min-height: 100vh !important;
    color: white !important;
}

@keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.glass-card {
    background: rgba(255, 255, 255, 0.1) !important;
    backdrop-filter: blur(15px) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    border-radius: 20px !important;
    padding: 20px;
    margin-bottom: 20px;
    transition: 0.3s;
}

.btn-cinema {
    background: #4cc9f0 !important;
    color: white !important;
    border-radius: 50px !important;
    padding: 10px 25px !important;
    border: none !important;
    font-weight: bold !important;
    width: 100%;
}

    </style>
</head>

<body>
<div id="app" v-cloak>
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div v-if="loading && !isLoggedIn" class="splash">
        <div class="drop-zone">
            <i class="fas fa-tint main-drop"></i>
            <div class="drop-ring"></div>
        </div>
        <h2 style="letter-spacing: 5px;">S O U F A I</h2>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© -->
    <div v-if="!isLoggedIn">
        <main class="main-wrapper">
            <div v-for="n in 15" :key="n" class="particle" :style="{left: Math.random()*100+'%', width: Math.random()*5+'px', height: Math.random()*5+'px', animationDelay: Math.random()*10+'s'}"></div>

            <div class="status-bar">
                <div class="status-item"><i class="fas fa-wifi"></i> Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±</div>
                <div class="status-item"><i class="far fa-clock"></i> {{ time }}</div>
            </div>

            <div class="login-card">
                <div class="card-inner">
                    <div class="drop-zone" style="margin: 0 auto;">
                        <i class="fas fa-tint main-drop" style="font-size: 50px;"></i>
                        <div class="drop-ring" style="animation-delay: 1s;"></div>
                    </div>

                    <!-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø³Ø§Ø¹Ø© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ù‡Ù†Ø§ -->
                    <div class="login-time-date">
                        <div class="time-display">{{ time }}</div>
                        <div class="date-display">
                            <i class="fas fa-calendar-alt"></i>
                            {{ todayDate }} | 
                            <i class="fas fa-calendar-day"></i>
                            {{ todayDay }}
                        </div>
                    </div>

               <h1 style="font-size: 28px; font-weight: 900; background: linear-gradient(to bottom, #FFD700, #FFA500, #B8860B); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 2px 4px rgba(0,0,0,0.3); margin-bottom: 5px;">
    Ù…Ø´Ø±ÙˆØ¹ Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ
</h1>

<p style="color: #ffffff; opacity: 0.9; font-size: 14px; font-weight: bold;">
    Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ 2026
</p>

                    <div class="input-group">
                        <input type="password" v-model="password" placeholder="â€¢â€¢â€¢â€¢" @keyup.enter="login">
                    </div>

                    <button class="btn-enter" @click="login">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©</button>

                    <div class="designer-signature">
                        <span class="designer-label">ØªØµÙ…ÙŠÙ… ÙˆØ¥Ø¹Ø¯Ø§Ø¯ ÙˆØªÙ†ÙÙŠØ°</span>
                        <span class="designer-name">Ø§Ù„Ø£Ø³ØªØ§Ø° Ù†ØµØ± Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠ</span>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div v-else class="app-container">
        <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ¶Ø¹ -->
         <div class="container-fluid mb-4">
            <div style="background: rgba(255,255,255,0.1); backdrop-filter: blur(15px); padding: 20px; border-radius: 25px; border: 1px solid rgba(255,255,255,0.2); box-shadow: 0 15px 35px rgba(0,0,0,0.2); text-align: center; margin-top: 15px;">
                
                <h6 class="text-white mb-3" style="opacity: 0.8; font-size: 0.9rem;">
                    <i class="fas fa-th-large me-2"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø³Ø±ÙŠØ¹Ø© 2026
                </h6>

                <div class="d-flex flex-wrap justify-content-center align-items-center gap-3">
                    
                    <button @click="showAddModal = true" class="btn btn-info shadow-sm" style="border-radius: 50px; padding: 10px 22px; font-weight: bold; border: none; color: white;">
                        <i class="fas fa-plus-circle me-1"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø´ØªØ±Ùƒ
                    </button>

                    <button @click="generateAIReport" class="btn btn-success shadow-sm" style="border-radius: 50px; padding: 10px 22px; font-weight: bold; border: none; color: white;">
                        <i class="fas fa-robot me-1"></i> ØªÙ‚Ø±ÙŠØ± AI
                    </button>

                    <button @click="scrollToTable" class="btn btn-primary shadow-sm" style="border-radius: 50px; padding: 10px 22px; font-weight: bold; border: none; color: white;">
                        <i class="fas fa-database me-1"></i> Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø§Ù…
                    </button>

                    <button @click="showMonthlyReport = true" class="btn btn-warning shadow-sm" style="border-radius: 50px; padding: 10px 22px; font-weight: bold; border: none; color: white;">
                        <i class="fas fa-chart-line me-1"></i> Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
                    </button>

                    <div style="width: 2px; height: 30px; background: rgba(255,255,255,0.2); margin: 0 10px;"></div>

                    <div class="d-flex gap-2 bg-dark bg-opacity-25 p-1" style="border-radius: 50px;">
                        <button class="btn btn-sm text-white rounded-circle" @click="changeTheme('normal')" title="ØµØ¨Ø§Ø­ÙŠ">
                            <i class="fas fa-sun"></i>
                        </button>
                        <button class="btn btn-sm text-white rounded-circle" @click="changeTheme('night')" title="Ù„ÙŠÙ„ÙŠ">
                            <i class="fas fa-moon"></i>
                        </button>
                        <button class="btn btn-sm text-white rounded-circle" @click="toggleFocusMode" :class="{ 'text-info': focusMode }" title="ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>

                </div>
            </div>
        </div>

            Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
        </button>

        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ -->
        <div v-if="smartLoading.show" class="smart-loading">
            <div class="loading-content">
                <i :class="smartLoading.icon + ' spinner'"></i>
                <h3>{{ smartLoading.title }}</h3>
                <p>{{ smartLoading.message }}</p>
                
                <div class="progress-bar">
                    <div class="progress-fill" :style="{ width: smartLoading.progress + '%' }"></div>
                </div>
                
                <div style="margin-top: 20px; color: var(--text-secondary); font-size: 14px;">
                    <i class="fas fa-info-circle"></i>
                    {{ smartLoading.hint }}
                </div>
            </div>
        </div>

        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© -->
        <div v-if="syncIndicator.show" :class="['sync-indicator', syncIndicator.type]">
            <i :class="syncIndicator.icon"></i>
            {{ syncIndicator.message }}
        </div>

        <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
        <div v-if="showAlertsModal" class="alerts-modal" @click.self="showAlertsModal = false">
            <div class="alerts-container">
                <div class="alerts-header">
                    <div>
                        <h2>
                            <i class="fas fa-exclamation-triangle"></i>
                            ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ© (5000+)
                        </h2>
                        <div class="alerts-stats">
                            <div class="alert-stat">
                                <div class="alert-stat-value">{{ highDebtAlerts.length }}</div>
                                <div class="alert-stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©</div>
                            </div>
                            <div class="alert-stat">
                                <div class="alert-stat-value">{{ formatNumber(totalHighDebt) }}</div>
                                <div class="alert-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©</div>
                            </div>
                            <div class="alert-stat">
                                <div class="alert-stat-value">{{ highestDebtAmount }}</div>
                                <div class="alert-stat-label">Ø£Ø¹Ù„Ù‰ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</div>
                            </div>
                        </div>
                    </div>
                    <button class="close-alerts" @click="showAlertsModal = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="alerts-content">
                    <div v-if="highDebtAlerts.length === 0" class="no-alerts">
                        <i class="fas fa-check-circle"></i>
                        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø¹Ø§Ù„ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
                        <p>Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø£Ù‚Ù„ Ù…Ù† 5000</p>
                    </div>
                    
                    <table v-else class="alerts-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ</th>
                                <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                                <th>Ø§Ù„Ù…Ø³Ù„Ù…</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©</th>
                                <th>Ø§Ù„Ù‚Ø±ÙŠØ©</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(debt, index) in highDebtAlerts" :key="index">
                                <td>{{ index + 1 }}</td>
                                <td>
                                    <strong>{{ debt.meterNumber }}</strong>
                                </td>
                                <td>
                                    <strong>{{ debt.name }}</strong>
                                </td>
                                <td>
                                    <span class="debt-badge high">
                                        {{ formatNumber(debt.remaining) }}
                                    </span>
                                </td>
                                <td>{{ formatNumber(debt.paid) }}</td>
                                <td>{{ formatNumber(debt.total) }}</td>
                                <td>
                                    <span v-if="debt.remaining >= 10000" class="debt-badge high">
                                        <i class="fas fa-exclamation-circle"></i> Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹
                                    </span>
                                    <span v-else class="debt-badge high">
                                        <i class="fas fa-exclamation-triangle"></i> Ø¹Ø§Ù„ÙŠØ©
                                    </span>
                                </td>
                                <td>{{ selectedVillage }}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <button v-if="highDebtAlerts.length > 0" class="btn btn-alert export-alerts-btn" @click="exportHighDebtToExcel">
                        <i class="fas fa-file-excel"></i>
                        ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
                    </button>
                </div>
            </div>
        </div>

        <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ -->
        <div v-if="showMonthlyReport" class="monthly-report-modal" @click.self="showMonthlyReport = false">
            <div class="monthly-report-modal-content">
                <div class="report-modal-header">
                    <div>
                        <h2>
                            <i class="fas fa-chart-line"></i>
                            ØªÙ‚Ø±ÙŠØ± Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù‚Ø±Ù‰ Ø§Ù„Ø´Ù‡Ø±ÙŠ
                        </h2>
                        <p style="margin-top: 5px; opacity: 0.9;">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</p>
                    </div>
                    <button class="close-report-modal" @click="showMonthlyReport = false">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="report-modal-body">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <button @click="fetchMonthlyReportData" class="refresh-btn">
                            <i class="fas fa-sync-alt" :class="{'fa-spin': monthlyReportLoading}"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>

                    <div class="monthly-report-stats">
                        <div class="monthly-report-stat-box">
                            <div style="font-size: 1.5rem; font-weight: bold;">{{ monthlyReportStats.villageCount }}</div>
                            <small>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø±Ù‰</small>
                        </div>
                        <div class="monthly-report-stat-box">
                            <div style="font-size: 1.5rem; font-weight: bold;">{{ monthlyReportStats.monthCount }}</div>
                            <small>Ø§Ù„Ø£Ø´Ù‡Ø± Ø§Ù„Ù…ØªØ§Ø­Ø©</small>
                        </div>
                        <div class="monthly-report-stat-box">
                            <div style="font-size: 1.5rem; font-weight: bold;">{{ formatNumber(monthlyReportStats.totalRemaining) }}</div>
                            <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</small>
                        </div>
                    </div>

                    <div class="monthly-report-controls">
                        <div class="month-selector">
                            <button 
                                v-for="(data, monthName) in monthlyReportData" 
                                :key="monthName"
                                @click="currentReportMonth = monthName"
                                :class="[
                                    'monthly-report-month-btn', 
                                    { active: currentReportMonth === monthName && monthName !== 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ' },
                                    { 'total-btn': monthName === 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ' && currentReportMonth === 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ' }
                                ]"
                            >
                                {{ monthName }}
                            </button>
                        </div>

                        <div style="position: relative;">
                            <i class="fas fa-search" style="position: absolute; right: 15px; top: 15px; color: #aaa;"></i>
                            <input 
                                v-model="monthlyReportSearchTerm" 
                                class="report-search-input" 
                                placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù‚Ø±ÙŠØ©..."
                            >
                        </div>
                    </div>

                    <div v-if="monthlyReportLoading" class="loading-overlay">
                        <i class="fas fa-spinner fa-spin fa-3x"></i>
                        <p style="margin-top: 15px;">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø±...</p>
                    </div>

                    <div v-else class="report-table-wrapper">
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th v-for="head in monthlyReportHeaders" :key="head">{{ head }}</th>
                                </tr>
                            </thead>
                            <transition-group name="fade" tag="tbody">
                                <tr 
                                    v-for="(row, index) in filteredMonthlyReportRows" 
                                    :key="index"
                                    :class="{'report-total-row': index === filteredMonthlyReportRows.length - 1 && !monthlyReportSearchTerm}"
                                >
                                    <td 
                                        v-for="(cell, cellIdx) in row" 
                                        :key="cellIdx"
                                        :class="getReportCellClass(cell, cellIdx, index)"
                                    >
                                        {{ formatReportCell(cell) }}
                                    </td>
                                </tr>
                            </transition-group>
                        </table>
                        
                        <div v-if="filteredMonthlyReportRows.length === 0" style="padding: 40px; text-align: center; color: #999;">
                            <i class="fas fa-search fa-2x"></i>
                            <p style="margin-top: 10px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ ØªØ·Ø§Ø¨Ù‚ Ø¨Ø­Ø«Ùƒ...</p>
                        </div>
                    </div>

                    <footer style="margin-top: 30px; padding: 20px; text-align: center; border-top: 1px solid #eee; color: #888;">
                        <p>Â© 2026 Ù…Ø´Ø±ÙˆØ¹ Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ | ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙÙŠ: {{ monthlyReportLastUpdated }}</p>
                    </footer>
                </div>
            </div>
        </div>

        <!-- ========== Ù„ÙˆØ­Ø© ØªØ­Ù„ÙŠÙ„ AI ========== -->
        <div class="ai-analysis-card" :class="{ 'hidden': !aiPanelVisible }" v-if="isLoggedIn && villageData.length > 0">
            <div class="ai-header">
                <div class="ai-title">
                    <i class="fas fa-robot"></i>
                    Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ
                    <span class="ai-badge">
                        <i class="fas fa-bolt"></i>
                        ØªØ­Ù„ÙŠÙ„ Ø­ÙŠ
                    </span>
                </div>
                <button class="btn-ai" @click="refreshAIAnalysis">
                    <i class="fas fa-sync-alt"></i>
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ù„ÙŠÙ„
                </button>
            </div>
            
            <div class="ai-stats-grid">
                <div class="ai-stat-item" @click="showDebtAnalysis" :class="aiStats.debtRiskLevel">
                    <div class="ai-stat-value">
                        <i class="fas fa-money-bill-wave"></i>
                        {{ formatNumber(aiStats.totalDebt) }}
                    </div>
                    <div class="ai-stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª</div>
                    <div class="ai-stat-trend" :class="aiStats.debtTrend">
                        <i :class="aiStats.debtTrend === 'up' ? 'fas fa-arrow-up' : 
                                   aiStats.debtTrend === 'down' ? 'fas fa-arrow-down' : 'fas fa-minus'"></i>
                        {{ aiStats.debtChange > 0 ? '+' : '' }}{{ aiStats.debtChange }}% Ø¹Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø§Ø¶ÙŠ
                    </div>
                </div>
                
                <div class="ai-stat-item success" @click="showRevenueAnalysis">
                    <div class="ai-stat-value">
                        <i class="fas fa-chart-line"></i>
                        {{ aiStats.collectionRate }}%
                    </div>
                    <div class="ai-stat-label">Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„</div>
                    <div class="ai-stat-trend" :class="aiStats.collectionTrend">
                        <i :class="aiStats.collectionTrend === 'up' ? 'fas fa-arrow-up' : 
                                   aiStats.collectionTrend === 'down' ? 'fas fa-arrow-down' : 'fas fa-minus'"></i>
                        {{ aiStats.collectionChange > 0 ? '+' : '' }}{{ aiStats.collectionChange }}%
                    </div>
                </div>
                
                <div class="ai-stat-item warning" @click="showConsumptionAnalysis">
                    <div class="ai-stat-value">
                        <i class="fas fa-tint"></i>
                        {{ formatNumber(aiStats.avgConsumption) }} Ù…Â³
                    </div>
                    <div class="ai-stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
                    <div class="ai-stat-trend" :class="aiStats.consumptionTrend">
                        <i :class="aiStats.consumptionTrend === 'up' ? 'fas fa-arrow-up' : 
                                   aiStats.consumptionTrend === 'down' ? 'fas fa-arrow-down' : 'fas fa-minus'"></i>
                        {{ aiStats.consumptionChange > 0 ? '+' : '' }}{{ aiStats.consumptionChange }}%
                    </div>
                </div>
                
                <div class="ai-stat-item danger" @click="showRiskAnalysis">
                    <div class="ai-stat-value">
                        <i class="fas fa-exclamation-triangle"></i>
                        {{ aiStats.riskSubscribers }}
                    </div>
                    <div class="ai-stat-label">Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø¹Ø§Ù„ÙŠÙˆ Ø§Ù„Ù…Ø®Ø§Ø·Ø±</div>
                    <div class="ai-stat-trend up">
                        <i class="fas fa-exclamation-circle"></i>
                        ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±ÙŠØ©
                    </div>
                </div>
            </div>
            
            <!-- ØªÙˆØµÙŠØ§Øª AI Ø§Ù„Ø³Ø±ÙŠØ¹Ø© -->
            <div class="ai-recommendations" v-if="aiRecommendations.length > 0">
                <div class="ai-recommendations-header">
                    <i class="fas fa-lightbulb" style="color: var(--ai-teal); font-size: 24px;"></i>
                    <h3 style="margin: 0; color: var(--ai-teal);">ØªÙˆØµÙŠØ§Øª Ø°ÙƒÙŠØ© ÙÙˆØ±ÙŠØ©</h3>
                </div>
                
                <div class="ai-recommendations-list">
                    <div class="ai-recommendation-item" v-for="(rec, index) in aiRecommendations" :key="index">
                        <div class="ai-recommendation-icon">
                            <i :class="rec.icon"></i>
                        </div>
                        <div class="ai-recommendation-content">
                            <div class="ai-recommendation-title">
                                <span class="ai-priority-badge" :class="'priority-' + rec.priority">
                                    {{ rec.priority === 'high' ? 'Ø¹Ø§Ù„ÙŠ' : 
                                       rec.priority === 'medium' ? 'Ù…ØªÙˆØ³Ø·' : 'Ù…Ù†Ø®ÙØ¶' }}
                                </span>
                                {{ rec.title }}
                            </div>
                            <div class="ai-recommendation-desc">{{ rec.description }}</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª AI -->
            <div class="ai-alerts-section" v-if="aiAlerts.length > 0">
                <div class="ai-alerts-header">
                    <i class="fas fa-exclamation-triangle" style="color: var(--alert-red);"></i>
                    <h3>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
                </div>
                <div class="ai-alerts-list">
                    <div v-for="(alert, index) in aiAlerts" :key="index" class="ai-alert-item" :class="alert.type">
                        <div class="ai-alert-icon" :class="alert.type">
                            <i :class="alert.icon"></i>
                        </div>
                        <div class="ai-alert-content">
                            <div class="ai-alert-title">{{ alert.title }}</div>
                            <div class="ai-alert-desc">{{ alert.description }}</div>
                            <div class="ai-alert-time">
                                <i class="far fa-clock"></i>
                                {{ alert.time }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn-ai btn-ai-secondary ai-pulse" @click="generateAIReport">
                    <i class="fas fa-file-medical-alt"></i>
                    ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„
                </button>
                <button class="btn-ai" @click="showAIInsights" style="margin-right: 10px;">
                    <i class="fas fa-chart-bar"></i>
                    Ø±Ø¤Ù‰ ÙˆØªØ­Ù„ÙŠÙ„Ø§Øª
                </button>
            </div>
        </div>
        <!-- ========== Ù†Ù‡Ø§ÙŠØ© Ù„ÙˆØ­Ø© AI ========== -->

        <!-- Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
        <button class="btn btn-chart chart-toggle-btn" @click="toggleCharts">
            <i class="fas fa-chart-bar"></i>
            Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³ÙˆÙ…
        </button>

        <!-- Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ -->
        <button class="ai-toggle-control ai-toggle-btn" @click="toggleAIPanel">
            <i class="fas" :class="aiPanelVisible ? 'fa-eye-slash' : 'fa-robot'"></i>
            {{ aiPanelVisible ? 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø°ÙƒØ§Ø¡' : 'Ø¹Ø±Ø¶ Ø§Ù„Ø°ÙƒØ§Ø¡' }}
        </button>

        <!-- Ø²Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© -->
        <button v-if="pendingChanges > 0" class="btn btn-success sync-all-btn" @click="syncAllChanges">
            <i class="fas fa-sync-alt"></i>
            Ù…Ø²Ø§Ù…Ù†Ø© {{ pendingChanges }} ØªØºÙŠÙŠØ±
        </button>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ -->
        <div v-if="isLoggedIn && selectedMonth === currentMonth" class="auto-month-indicator">
            <i class="fas fa-calendar-check"></i>
            <span class="month-indicator">ğŸ“…</span>
            <span>Ø£Ù†Øª ØªØªØµÙØ­ <strong>Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</strong> ({{ selectedMonth }}) - ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</span>
        </div>

        <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ -->
        <div class="smart-search-results" :class="{ 'show': showSearchResults }" v-if="showSearchResults">
            <div class="search-result-header">
                <h4>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ</h4>
                <span class="search-result-count">{{ smartSearchResults.length }} Ù†ØªÙŠØ¬Ø©</span>
            </div>
            <div v-if="smartSearchResults.length > 0">
                <div v-for="(result, index) in smartSearchResults" :key="index" 
                     class="search-result-item" 
                     :class="getDebtLevelClass(result.remaining)"
                     @click="scrollToRow(result.originalIndex)">
                    <div class="search-result-info">
                        <div class="search-result-name">{{ result.name }}</div>
                        <div class="search-result-details">
                            <span>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯: {{ result.meterNumber }}</span>
                            <span>Ø§Ù„Ù…Ø³Ù„Ù…: {{ formatNumber(result.paid) }}</span>
                            <span>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: {{ formatNumber(result.remaining) }}</span>
                        </div>
                    </div>
                    <div class="search-result-debt" :class="getDebtLevelClass(result.remaining)">
                        {{ formatNumber(result.remaining) }}
                    </div>
                </div>
            </div>
            <div v-else class="no-search-results">
                <i class="fas fa-search"></i>
                <h4>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</h4>
                <p>Ø­Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù…ØŒ Ø±Ù‚Ù… Ø¹Ø¯Ø§Ø¯ØŒ Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø°ÙƒÙŠØ©</p>
            </div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… Ù…Ø¹ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨ -->
        <div class="control-bar"><div class="smart-search-container" style="flex: 2; margin: 0 15px;">
    <div class="smart-search-box">
        <input type="text" 
               v-model="searchQuery" 
               placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯ØŒ Ø£Ùˆ Ø§Ù„Ù‚Ø±ÙŠØ©..." 
               @input="executeSmartSearch" 
               @focus="showSearchResults = true">
        
        <button @click="startVoiceRecognition" :class="{'recording': isRecording}">
            <i class="fas fa-microphone" v-if="!isRecording" style="color: var(--primary);"></i>
            <span class="pulse" v-else></span>
        </button>
        <i class="fas fa-search search-icon" style="margin-right: 10px; color: var(--primary);"></i>
    </div>

    <div v-if="showSearchResults && smartSearchResults.length > 0" class="search-results-dropdown" 
         style="position: absolute; top: 100%; right: 0; left: 0; background: var(--bg-card); z-index: 1000; border-radius: 15px; box-shadow: var(--shadow-lg); max-height: 300px; overflow-y: auto; margin-top: 10px; border: 1px solid var(--primary);">
        <div v-for="res in smartSearchResults" :key="res.id" 
             @click="selectSearchResult(res)"
             style="padding: 12px 15px; border-bottom: 1px solid var(--border-color); cursor: pointer; display: flex; justify-content: space-between; align-items: center;">
            <div style="display: flex; flex-direction: column;">
                <span style="font-weight: bold; color: var(--text-primary);">{{ res.name }}</span>
                <small style="color: var(--text-muted);">Ø¹Ø¯Ø§Ø¯: {{ res.meterId }} | Ù‚Ø±ÙŠØ©: {{ res.village }}</small>
            </div>
            <span :style="{color: res.debt > 0 ? 'var(--danger)' : 'var(--success)', fontWeight: 'bold'}">
                {{ res.debt }} Ø±ÙŠØ§Ù„
            </span>
        </div>
    </div>
</div>

            <div class="user-info">
                <h3 style="margin: 0;">
                    <i class="fas fa-user" style="margin-left: 8px;"></i>
                    {{ currentUser.name }}
                </h3>
                <p style="margin: 5px 0 0; font-size: 14px; opacity: 0.9;">
                    <i class="fas fa-map-marker-alt" style="margin-left: 5px;"></i>
                    {{ selectedVillage }} | 
                    <i class="fas fa-calendar-alt" style="margin: 0 5px;"></i>
                    {{ selectedMonth }}
                    <span v-if="selectedMonth === currentMonth" style="color: #00b09b; font-weight: bold;">
                        (Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ)
                    </span>
                </p>
            </div>

            <!-- Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨ -->
            <div class="smart-search-container">
                <div class="smart-search-box">
                    <input type="text" 
                           v-model="searchQuery" 
                           placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ù‚Ø±ÙŠØ©ØŒ Ø£Ùˆ Ø§Ø·Ù„Ø¨ ØµÙˆØªÙŠØ§Ù‹ (Ù…Ø«Ù„Ø§Ù‹: Ø¯ÙŠÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† 5000)..."
                           @input="executeSmartSearch"
                           @focus="showSearchResults = true"
                           @blur="setTimeout(() => { showSearchResults = false }, 200)">
                    <button @click="startVoiceRecognition" :class="{'recording': isRecording}">
                        <i class="fas fa-microphone" v-if="!isRecording"></i>
                        <span class="pulse" v-else></span>
                    </button>
                    <i class="fas fa-search search-icon"></i>
                </div>
            </div>

            <!-- Ø²Ø± AI Ù…Ø¹ Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª -->
            <div class="ai-control-btn" style="position: relative;">
                <button class="btn-ai" @click="toggleAIPanel">
                    <i class="fas fa-robot"></i>
                    {{ aiPanelVisible ? 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø°ÙƒØ§Ø¡' : 'Ø¹Ø±Ø¶ Ø§Ù„Ø°ÙƒØ§Ø¡' }}
                </button>
                <div v-if="aiAlerts.length > 0" class="ai-badge-count">
                    {{ aiAlerts.length }}
                </div>
            </div>

            <!-- Ø²Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ø¹ Ø§Ù„Ø¹Ø¯Ø§Ø¯ -->
            <div style="position: relative;">
                <button class="btn btn-alert" @click="showAlertsModal = true">
                    <i class="fas fa-exclamation-triangle"></i>
                    ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª
                </button>
                <div v-if="highDebtAlerts.length > 0" class="alerts-btn-badge">
                    {{ highDebtAlerts.length }}
                </div>
            </div>

            <select v-model="selectedVillage" @change="onVillageChange" style="min-width: 200px; padding: 12px 15px; border-radius: 10px; background: rgba(255,255,255,0.9); color: #333; font-weight: bold;">
    <option value="">--- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø±ÙŠØ© ---</option>
    <option value="Ø§Ù„Ø³ÙˆÙØ¹ÙŠ">Ø§Ù„Ø³ÙˆÙØ¹ÙŠ</option>
    <option value="Ø§Ù„Ø¹Ù„ÙŠØ§">Ø§Ù„Ø¹Ù„ÙŠØ§</option>
    <option value="Ø§Ù„Ø³ÙÙ„Ù‰">Ø§Ù„Ø³ÙÙ„Ù‰</option>
    <option value="Ø§Ù„Ø´Ø¹Ø§Ø¨ÙŠ">Ø§Ù„Ø´Ø¹Ø§Ø¨ÙŠ</option>
    <option value="Ø§Ù„Ø¬Ø¨Ù„">Ø§Ù„Ø¬Ø¨Ù„</option>
    <option value="Ø­ÙŠØ²Ø§Ù†">Ø­ÙŠØ²Ø§Ù†</option>
    <option value="Ø±Ù‚Ø´">Ø±Ù‚Ø´</option>
    <option value="Ø§Ù„Ø¶Ø±ÙØ©">Ø§Ù„Ø¶Ø±ÙØ©</option>
</select>
                <option v-for="(url, village) in villageAPIs" :value="village">
                    {{ village }}
                </option>
            </select>

            <select v-model="selectedMonth" @change="onMonthChange" style="position: relative;">
                <option v-for="m in 12" 
                        :value="'Ø´Ù‡Ø± ' + m" 
                        :class="{ 'current-month': 'Ø´Ù‡Ø± ' + m === currentMonth }">
                    {{ 'Ø´Ù‡Ø± ' + m }} 
                    <span v-if="'Ø´Ù‡Ø± ' + m === currentMonth">(Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ)</span>
                </option>
            </select>

            <button class="btn btn-success" @click="exportToExcel">
                <i class="fas fa-file-excel"></i>
                ØªØµØ¯ÙŠØ± Excel
            </button>

            <button class="btn btn-danger" @click="logout">
                <i class="fas fa-sign-out-alt"></i>
                Ø®Ø±ÙˆØ¬
            </button>
        </div>

        <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© -->
        <div v-if="showMemoryManagement" class="memory-management">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <h3 style="color: #667eea; margin: 0;">
                    <i class="fas fa-microchip" style="margin-left: 8px;"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©
                </h3>
                <div style="display: flex; gap: 10px;">
                    <button class="memory-management-btn" @click="optimizeMemory">
                        <i class="fas fa-broom"></i>
                        ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
                    </button>
                    <button class="memory-management-btn" @click="clearMemoryCache">
                        <i class="fas fa-trash"></i>
                        Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´
                    </button>
                </div>
            </div>
            
            <div class="memory-stats">
                <div class="memory-stat">
                    <div class="memory-stat-value">{{ memoryStats.cacheSize }} ÙƒÙŠÙ„ÙˆØ¨Ø§ÙŠØª</div>
                    <div class="memory-stat-label">Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©</div>
                    <div class="memory-indicator">
                        <div class="memory-indicator-fill" :style="{ width: memoryStats.cachePercentage + '%' }"></div>
                    </div>
                </div>
                
                <div class="memory-stat">
                    <div class="memory-stat-value">{{ memoryStats.itemsCount }}</div>
                    <div class="memory-stat-label">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø®Ø²Ù†Ø©</div>
                </div>
                
                <div class="memory-stat">
                    <div class="memory-stat-value">{{ memoryStats.pendingChanges }}</div>
                    <div class="memory-stat-label">ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</div>
                </div>
                
                <div class="memory-stat">
                    <div class="memory-stat-value">{{ memoryStats.lastCleanup }}</div>
                    <div class="memory-stat-label">Ø¢Ø®Ø± ØªÙ†Ø¸ÙŠÙ</div>
                </div>
            </div>
        </div>

        <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© AI -->
        <div class="status-bar">
            <div class="status-item">
                <span class="status-dot" :class="{ 'online': isOnline }"></span>
                <span>{{ isOnline ? 'Ù…ØªØµÙ„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª' : 'ØºÙŠØ± Ù…ØªØµÙ„' }}</span>
            </div>
            
            <div class="status-item">
                <span class="status-dot" :class="{ 'syncing': isSyncing }"></span>
                <span>{{ isSyncing ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...' : 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©' }}</span>
            </div>
            
            <div class="status-item" v-if="lastSyncTime">
                <i class="fas fa-clock"></i>
                <span>Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©: {{ lastSyncTime }}</span>
            </div>
            
            <div class="status-item" v-if="pendingChanges > 0">
                <i class="fas fa-pencil-alt" style="color: #ff9800;"></i>
                <span>ØªØºÙŠÙŠØ±Ø§Øª Ù…Ø¹Ù„Ù‚Ø©: {{ pendingChanges }}</span>
            </div>
            
            <div class="status-item" @click="showMemoryManagement = !showMemoryManagement" style="cursor: pointer;">
                <i class="fas fa-microchip" style="color: #667eea;"></i>
                <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© {{ showMemoryManagement ? 'â–²' : 'â–¼' }}</span>
            </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
        <div class="charts-section" :class="{ 'visible': chartsVisible }">
            <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ 1: Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-money-bill-wave"></i>
                        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - {{ selectedVillage }}
                    </div>
                    <div class="chart-controls">
                        <select class="chart-type-select" v-model="chartTypes.revenue" @change="updateChart('revenue')">
                            <option value="bar">Ø´Ø±ÙŠØ·ÙŠ</option>
                            <option value="line">Ø®Ø·ÙŠ</option>
                            <option value="pie">Ø¯Ø§Ø¦Ø±ÙŠ</option>
                        </select>
                        <button class="btn btn-primary" @click="fullscreenChart('revenue')" style="padding: 8px 12px;">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas ref="revenueChart"></canvas>
                </div>
                <div class="chart-statistics">
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ formatNumber(totalRevenue) }}</div>
                        <div class="chart-stat-label">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ formatNumber(totalPaid) }}</div>
                        <div class="chart-stat-label">Ø§Ù„Ù…Ø³Ù„Ù…</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ formatNumber(totalRemaining) }}</div>
                        <div class="chart-stat-label">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
                    </div>
                </div>
            </div>

            <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ 2: ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-chart-pie"></i>
                        ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª
                    </div>
                    <div class="chart-controls">
                        <select class="chart-type-select" v-model="chartTypes.debt" @change="updateChart('debt')">
                            <option value="pie">Ø¯Ø§Ø¦Ø±ÙŠ</option>
                            <option value="doughnut">Ø¯ÙˆÙ†Ø§Øª</option>
                            <option value="bar">Ø´Ø±ÙŠØ·ÙŠ</option>
                        </select>
                        <button class="btn btn-primary" @click="fullscreenChart('debt')" style="padding: 8px 12px;">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas ref="debtChart"></canvas>
                </div>
                <div class="chart-statistics">
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ highDebtCount }}</div>
                        <div class="chart-stat-label">Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ mediumDebtCount }}</div>
                        <div class="chart-stat-label">Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ù…ØªÙˆØ³Ø·Ø©</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ lowDebtCount }}</div>
                        <div class="chart-stat-label">Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ù‚Ù„ÙŠÙ„Ø©</div>
                    </div>
                </div>
            </div>

            <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ 3: Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø´Ù‡Ø±ÙŠ -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-tint"></i>
                        Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ
                    </div>
                    <div class="chart-controls">
                        <select class="chart-type-select" v-model="chartTypes.consumption" @change="updateChart('consumption')">
                            <option value="bar">Ø´Ø±ÙŠØ·ÙŠ</option>
                            <option value="line">Ø®Ø·ÙŠ</option>
                            <option value="radar">Ø±Ø§Ø¯Ø§Ø±</option>
                        </select>
                        <button class="btn btn-primary" @click="fullscreenChart('consumption')" style="padding: 8px 12px;">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas ref="consumptionChart"></canvas>
                </div>
                <div class="chart-statistics">
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ formatNumber(averageConsumption) }} Ù…Â³</div>
                        <div class="chart-stat-label">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ highestConsumption }} Ù…Â³</div>
                        <div class="chart-stat-label">Ø£Ø¹Ù„Ù‰ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ lowestConsumption }} Ù…Â³</div>
                        <div class="chart-stat-label">Ø£Ù‚Ù„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</div>
                    </div>
                </div>
            </div>

            <!-- Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ 4: Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£Ø´Ù‡Ø± -->
            <div class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-chart-line"></i>
                        Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£Ø´Ù‡Ø±
                    </div>
                    <div class="chart-controls">
                        <select class="chart-type-select" v-model="chartTypes.monthly" @change="updateChart('monthly')">
                            <option value="line">Ø®Ø·ÙŠ</option>
                            <option value="bar">Ø´Ø±ÙŠØ·ÙŠ</option>
                        </select>
                        <button class="btn btn-primary" @click="fullscreenChart('monthly')" style="padding: 8px 12px;">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas ref="monthlyChart"></canvas>
                </div>
                <div class="chart-statistics">
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ bestMonth }}</div>
                        <div class="chart-stat-label">Ø£Ø¹Ù„Ù‰ Ø´Ù‡Ø±</div>
                    </div>
                    <div class="chart-stat">
                        <div class="chart-stat-value">{{ formatNumber(bestMonthRevenue) }}</div>
                        <div class="chart-stat-label">Ù‚ÙŠÙ…ØªÙ‡</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="table-container">
            <div v-if="loading && !smartLoading.show" class="loading-content">
                <i class="fas fa-spinner fa-spin spinner"></i>
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
            
            <table v-else>
                <thead>
                    <tr>
                        <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                        <th>Ø§Ù„Ø§Ø³Ù…</th>
                        <th>Ù‚Ø±Ø§Ø¡Ø© Ø³Ø§Ø¨Ù‚Ø©</th>
                        <th>Ù‚Ø±Ø§Ø¡Ø© Ø­Ø§Ù„ÙŠØ©</th>
                        <th>1-8 Ù…Â³</th>
                        <th>9 ÙØ£ÙƒØ«Ø±</th>
                        <th>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ</th>
                        <th>Ø±Ø³ÙˆÙ… Ø«Ø§Ø¨ØªØ©</th>
                        <th>Ù…ØªØ£Ø®Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</th>
                        <th>Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø£Ø®Ø±Ù‰</th>
                        <th>Ø§Ù„Ù…Ø³Ù„Ù…</th>
                        <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    </tr>
                </thead>
                <tbody>
                    <tr v-for="(row, rowIndex) in filteredDataWithTotal" 
                        :key="rowIndex"
                        :class="getRowClass(rowIndex, row)">
                        <td v-for="(cell, cellIndex) in row" 
                            :key="cellIndex"
                            :contenteditable="canEdit(rowIndex, cellIndex, row)"
                            :class="{
                                'editable': canEdit(rowIndex, cellIndex, row),
                                'high-debt-cell': isHighDebtCell(rowIndex, cellIndex, cell, row),
                                'high-debt-row': hasHighDebt(rowIndex, row),
                                'saving': isSaving(rowIndex, cellIndex),
                                'saved': isSaved(rowIndex, cellIndex),
                                'unsaved-change': hasUnsavedChange(rowIndex, cellIndex)
                            }"
                            @blur="saveCell($event, rowIndex, cellIndex, row[0])"
                            @keydown.enter="$event.target.blur()"
                            :title="getCellTitle(rowIndex, cellIndex, row)">
                            {{ cell }}
                            <span v-if="hasUnsavedChange(rowIndex, cellIndex)" class="cached-indicator">
                                <i class="fas fa-pencil-alt"></i>
                            </span>
                            <span v-if="isHighDebtCell(rowIndex, cellIndex, cell, row)" class="debt-badge high" style="display: inline-block; margin-right: 5px; padding: 2px 6px; font-size: 12px;">
                                <i class="fas fa-exclamation-circle"></i>
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="developer-signature">
            <i class="fas fa-code"></i>
            Ù†Ø¸Ø§Ù… Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ - ØªØµÙ…ÙŠÙ… ÙˆØªØ·ÙˆÙŠØ±: Ù†ØµØ± Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠ
            <span style="color: var(--ai-purple); margin-right: 10px;">
                <i class="fas fa-robot"></i>
                Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…ØªÙƒØ§Ù…Ù„
            </span>
        </div>

        <!-- ÙˆØ¶Ø¹ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø±Ø³Ù… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠ -->
        <div v-if="fullscreenChartId" class="chart-fullscreen">
            <button class="close-fullscreen" @click="closeFullscreen">
                <i class="fas fa-times"></i>
            </button>
            <div v-if="fullscreenChartId === 'revenue'" class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-money-bill-wave"></i>
                        Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - {{ selectedVillage }} - {{ selectedMonth }}
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas ref="revenueChartFullscreen"></canvas>
                </div>
            </div>
            <div v-else-if="fullscreenChartId === 'debt'" class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-chart-pie"></i>
                        ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª - {{ selectedVillage }} - {{ selectedMonth }}
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas ref="debtChartFullscreen"></canvas>
                </div>
            </div>
            <div v-else-if="fullscreenChartId === 'consumption'" class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-tint"></i>
                        Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ - {{ selectedVillage }} - {{ selectedMonth }}
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas ref="consumptionChartFullscreen"></canvas>
                </div>
            </div>
            <div v-else-if="fullscreenChartId === 'monthly'" class="chart-container">
                <div class="chart-header">
                    <div class="chart-title">
                        <i class="fas fa-chart-line"></i>
                        Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£Ø´Ù‡Ø± - {{ selectedVillage }}
                    </div>
                </div>
                <div class="chart-canvas-container">
                    <canvas ref="monthlyChartFullscreen"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, computed, watch, onMounted, onBeforeUnmount, nextTick } = Vue;

// Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
const USERS = {
    "5674": { 
        name: "Ù†ØµØ± Ø§Ù„Ø¹Ø§Ù…Ø±ÙŠ", 
        role: "Ù…Ø¯ÙŠØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
        permissions: {
            canEdit: [3, 10, 11], // D, K, L - Ù‚Ø±Ø§Ø¡Ø© Ø­Ø§Ù„ÙŠØ©ØŒ Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø£Ø®Ø±Ù‰ØŒ Ø§Ù„Ù…Ø³Ù„Ù…
            canViewAll: true
        }
    },
    "6785": { 
        name: "Ø³Ù„ÙŠÙ…Ø§Ù† Ø§Ù„ÙØ±Ø²Ø¹ÙŠ", 
        role: "Ø£Ù…ÙŠÙ† Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚",
        permissions: {
            canEdit: [10, 11], // K, L - Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø£Ø®Ø±Ù‰ØŒ Ø§Ù„Ù…Ø³Ù„Ù… ÙÙ‚Ø·
            canViewAll: true
        }
    },
    "4562": { 
        name: "Ø£ÙƒØ±Ù… Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ", 
        role: "Ù…Ø´Ø±Ù Ø§Ù„Ù…Ø´Ø±ÙˆØ¹",
        permissions: {
            canEdit: [3], // D - Ù‚Ø±Ø§Ø¡Ø© Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·
            canViewAll: true
        }
    },
    "7892": { 
        name: "ÙŠÙˆØ³Ù Ø§Ù„Ø­Ø¬Ø§Ø¬ÙŠ", 
        role: "Ø§Ù„Ù…Ø­Ø§Ø³Ø¨",
        permissions: {
            canEdit: [], // Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·
            canViewAll: true
        }
    }
};

createApp({
    setup() {
        // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© - ÙƒÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø©
        const isLoggedIn = ref(false);
        const password = ref('');
        const currentUser = ref({});
        const loading = ref(false);
        const searchQuery = ref('');
        const villageData = ref([]);
        const selectedVillage = ref('Ø§Ù„Ø³ÙˆÙØ¹ÙŠ');
        const selectedMonth = ref('');
        const isSyncing = ref(false);
        const isOnline = ref(navigator.onLine);
        const lastSyncTime = ref('');
        const showAlertsModal = ref(false);
        const showMemoryManagement = ref(false);
        const showMonthlyReport = ref(false);
        const time = ref('');
        
        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙŠÙˆÙ…
        const todayDate = ref('');
        const todayDay = ref('');
        
        // Ù…ØªØºÙŠØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø¸Ù‡ÙˆØ±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© (Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹)
        const chartsVisible = ref(false);
        
        // Ù…ØªØºÙŠØ± Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø¸Ù‡ÙˆØ±/Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© AI
        const aiPanelVisible = ref(true);
        
        // Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        const fullscreenChartId = ref('');
        const chartInstances = ref({});
        const chartTypes = ref({
            revenue: 'bar',
            debt: 'pie',
            consumption: 'bar',
            monthly: 'line'
        });
        
        // ============ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨ ============
        const showSearchResults = ref(false);
        const isRecording = ref(false);
        const smartSearchResults = ref([]);
        
        // ============ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„ÙˆØ¶Ø¹ ============
        const currentTheme = ref('normal');
        const focusMode = ref(false);
        
        // Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
        const memoryManager = ref({
            enabled: true,
            maxCacheSize: 10 * 1024 * 1024,
            maxItems: 1000,
            cleanupInterval: 5 * 60 * 1000,
            lastCleanup: Date.now(),
            cacheHits: 0,
            cacheMisses: 0,
            compressionEnabled: true
        });

        // Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Ø§Ù„Ø°ÙƒÙŠ
        const dataCache = ref({
            villageData: {},
            pendingChanges: {},
            lastSynced: {},
            backup: {},
            metadata: {
                size: 0,
                items: 0,
                lastUpdated: Date.now()
            }
        });
        
        // Ù…Ø¤Ø´Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
        const isCachedData = ref(false);
        
        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        const memoryStats = computed(() => {
            const stats = {
                cacheSize: 0,
                itemsCount: 0,
                cachePercentage: 0,
                pendingChanges: pendingChanges.value,
                lastCleanup: formatTimeAgo(memoryManager.value.lastCleanup),
                hitRatio: memoryManager.value.cacheHits + memoryManager.value.cacheMisses > 0 
                    ? Math.round((memoryManager.value.cacheHits / (memoryManager.value.cacheHits + memoryManager.value.cacheMisses)) * 100)
                    : 0
            };
            
            const cacheSize = JSON.stringify(dataCache.value).length;
            stats.cacheSize = Math.round(cacheSize / 1024);
            stats.cachePercentage = Math.min(100, Math.round((cacheSize / memoryManager.value.maxCacheSize) * 100));
            
            let itemCount = 0;
            for (const village in dataCache.value.villageData) {
                for (const month in dataCache.value.villageData[village]) {
                    itemCount++;
                }
            }
            stats.itemsCount = itemCount;
            
            return stats;
        });

        // Ø§Ù„ØªØªØ¨Ø¹
        const pendingChanges = ref(0);
        const savingCells = ref([]);
        const savedCells = ref([]);
        const backupHistory = ref([]);
        
        // Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©
        const syncIndicator = ref({
            show: false,
            type: 'info',
            message: '',
            icon: 'fas fa-info-circle'
        });

        const smartLoading = ref({
            show: false,
            title: '',
            message: '',
            icon: 'fas fa-sync-alt',
            progress: 0,
            hint: ''
        });

        // Ø±ÙˆØ§Ø¨Ø· Google Sheets
        const villageAPIs = {
            "Ø§Ù„Ø³ÙˆÙØ¹ÙŠ": "https://script.google.com/macros/s/AKfycbxwk4kUq6iKrILZZj97hoHw4x8oJLTcJW_imP3J7LloQBR79DDlY31AAcRRHytcJNon/exec",
            "Ø§Ù„Ø¹Ù„ÙŠØ§": "https://script.google.com/macros/s/AKfycbwxfCWbufmKMvNZXzmuK6PqbmUSH7px3HmIQcJl2Am8vM5FCCNZHQ_kIrTBbzdDe6-aMQ/exec",
            "Ø§Ù„Ø³ÙÙ„Ù‰": "https://script.google.com/macros/s/AKfycbwrtgwr8WYMlNcQzj3qCF6-OvAei6EFK_e2LzuMLAfc4WDVlguqdCOzdF9gTWh8mYA/exec",
            "Ø§Ù„Ø´Ø¹Ø§Ø¨ÙŠ": "https://script.google.com/macros/s/AKfycbyAcUuicFALQFVgMjc7TSCmZ1lzCzoMFjHOZy2q-nlZv2nq0bCY77-0BpY7U2zFRWJ2AA/exec",
            "Ø§Ù„Ø¬Ø¨Ù„": "https://script.google.com/macros/s/AKfycbzr81y7Am5rC4VGOwwzFDpACNzIe9sE9DW9zy1SFy4HNSOrWs4gshHBlCCCXKYnPFFC/exec",
            "Ø­ÙŠØ²Ø§Ù†": "https://script.google.com/macros/s/AKfycbyZZ5AAuEineNuWWMsMYJaqTcsH7KA8l2Xov6AC_qJn4uAFhNRxRW1A1icCVYlH79bK/exec",
            "Ø±Ù‚Ø´": "https://script.google.com/macros/s/AKfycbxMD6WXWvALfYxuCre5On3yS1u7HqxxdjYUqVF8s1KfNgcQTqKQXQ3DxbEh0RHX08gA/exec",
            "Ø§Ù„Ø¶Ø±ÙØ©": "https://script.google.com/macros/s/AKfycbzgjurHK5GQX43r7aqP_365sL-2CQksnwqlkdYP03pcZLna-6it60FfpcQ0TasMAG0/exec"
        };
        
        // ============ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ ============
        const monthlyReportData = ref({});
        const monthlyReportLoading = ref(false);
        const monthlyReportSearchTerm = ref('');
        const currentReportMonth = ref('');
        const monthlyReportLastUpdated = ref('-');
        
        // Ø±Ø§Ø¨Ø· Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
        const MONTHLY_REPORT_URL = 'https://script.google.com/macros/s/AKfycbwCLB2B8LGwefWiNDacjM4YX8N86NWu-GgM8i6V3cm0PkxG-OQ1bFiNNuPyYHuvwnLXvA/exec';

        // ========== Ù…ØªØºÙŠØ±Ø§Øª AI Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ==========
        
        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª AI
        const aiStats = ref({
            totalDebt: 0,
            debtTrend: 'stable',
            debtChange: 0,
            debtRiskLevel: '',
            collectionRate: 0,
            collectionTrend: 'stable',
            collectionChange: 0,
            avgConsumption: 0,
            consumptionTrend: 'stable',
            consumptionChange: 0,
            riskSubscribers: 0,
            aiStatus: 'Ù†Ø´Ø·'
        });
        
        // ØªÙˆØµÙŠØ§Øª AI
        const aiRecommendations = ref([]);
        
        // ØªÙ†Ø¨ÙŠÙ‡Ø§Øª AI
        const aiAlerts = ref([]);
        
        // Ø­Ø§Ù„Ø© AI
        const aiStatus = ref('Ø¬Ø§Ù‡Ø²');
        
        // ============ Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…Ø±ÙƒØ¨ ============
        
        // ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
        const executeSmartSearch = () => {
            const query = searchQuery.value.trim().toLowerCase();
            
            if (!query) {
                smartSearchResults.value = [];
                showSearchResults.value = false;
                return;
            }
            
            showSearchResults.value = true;
            smartSearchResults.value = [];
            
            if (villageData.value.length === 0) return;
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø°ÙƒÙŠØ©
            const parsedQuery = parseSmartQuery(query);
            
            villageData.value.forEach((row, rowIndex) => {
                if (rowIndex < 2 || getRowClass(rowIndex, row) === 'total-row') return;
                
                const meterNumber = row[0] || '';
                const name = row[1] || '';
                const remaining = parseFloat(row[12] || 0);
                const paid = parseFloat(row[11] || 0);
                const total = parseFloat(row[9] || 0);
                
                let matches = false;
                
                // 1. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ Ø§Ù„Ø¹Ø§Ø¯ÙŠ
                if (meterNumber.toString().toLowerCase().includes(query) || 
                    name.toLowerCase().includes(query)) {
                    matches = true;
                }
                
                // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø°ÙƒÙŠØ©
                else if (parsedQuery.debtMin !== null && remaining >= parsedQuery.debtMin) {
                    matches = true;
                }
                else if (parsedQuery.debtMax !== null && remaining <= parsedQuery.debtMax) {
                    matches = true;
                }
                else if (parsedQuery.debtRange.min !== null && 
                         parsedQuery.debtRange.max !== null &&
                         remaining >= parsedQuery.debtRange.min &&
                         remaining <= parsedQuery.debtRange.max) {
                    matches = true;
                }
                else if (parsedQuery.unpaid && paid === 0) {
                    matches = true;
                }
                else if (parsedQuery.highDebt && remaining >= 5000) {
                    matches = true;
                }
                
                // 3. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ØªÙ‚Ø¯Ù… Ø¨Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                else if (parsedQuery.conditions.length > 0) {
                    matches = parsedQuery.conditions.every(condition => {
                        switch(condition.type) {
                            case 'debt_min':
                                return remaining >= condition.value;
                            case 'debt_max':
                                return remaining <= condition.value;
                            case 'paid_min':
                                return paid >= condition.value;
                            case 'paid_max':
                                return paid <= condition.value;
                            default:
                                return false;
                        }
                    });
                }
                
                if (matches) {
                    smartSearchResults.value.push({
                        originalIndex: rowIndex,
                        meterNumber: meterNumber,
                        name: name,
                        remaining: remaining,
                        paid: paid,
                        total: total,
                        rowData: row
                    });
                }
            });
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù‚Ù„ÙŠÙ„Ø©ØŒ Ø£Ø¶Ù Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª
            if (smartSearchResults.value.length === 0) {
                showSearchSuggestions(query);
            }
        };
        
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø°ÙƒÙŠ
        const parseSmartQuery = (query) => {
            const result = {
                debtMin: null,
                debtMax: null,
                debtRange: { min: null, max: null },
                unpaid: false,
                highDebt: false,
                conditions: []
            };
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
            if (query.includes('Ø¯ÙŠÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù†') || query.includes('Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø£ÙƒØ«Ø± Ù…Ù†')) {
                const match = query.match(/(\d+)/);
                if (match) {
                    result.debtMin = parseInt(match[1]);
                    result.conditions.push({ type: 'debt_min', value: parseInt(match[1]) });
                }
            }
            
            else if (query.includes('Ø¯ÙŠÙˆÙ† Ø£Ù‚Ù„ Ù…Ù†') || query.includes('Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø£Ù‚Ù„ Ù…Ù†')) {
                const match = query.match(/(\d+)/);
                if (match) {
                    result.debtMax = parseInt(match[1]);
                    result.conditions.push({ type: 'debt_max', value: parseInt(match[1]) });
                }
            }
            
            else if (query.includes('Ø¯ÙŠÙˆÙ† Ø¨ÙŠÙ†') || query.includes('Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¨ÙŠÙ†')) {
                const matches = query.match(/(\d+).*?(\d+)/);
                if (matches && matches.length >= 3) {
                    result.debtRange.min = parseInt(matches[1]);
                    result.debtRange.max = parseInt(matches[2]);
                    result.conditions.push(
                        { type: 'debt_min', value: parseInt(matches[1]) },
                        { type: 'debt_max', value: parseInt(matches[2]) }
                    );
                }
            }
            
            else if (query.includes('ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹') || query.includes('Ù„Ù… ÙŠØ¯ÙØ¹') || query.includes('Ù„Ù… ÙŠØ³Ø¯Ø¯')) {
                result.unpaid = true;
                result.conditions.push({ type: 'paid_max', value: 0 });
            }
            
            else if (query.includes('Ø¯ÙŠÙˆÙ† Ø¹Ø§Ù„ÙŠØ©') || query.includes('Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©')) {
                result.highDebt = true;
                result.conditions.push({ type: 'debt_min', value: 5000 });
            }
            
            else if (query.includes('Ø£ÙƒØ«Ø± Ù…Ù†') && query.includes('Ù…Ø¯ÙÙˆØ¹')) {
                const match = query.match(/(\d+)/);
                if (match) {
                    result.conditions.push({ type: 'paid_min', value: parseInt(match[1]) });
                }
            }
            
            return result;
        };
        
        // Ø¹Ø±Ø¶ Ù…Ù‚ØªØ±Ø­Ø§Øª Ø§Ù„Ø¨Ø­Ø«
        const showSearchSuggestions = (query) => {
            const suggestions = [
                { text: 'Ø¯ÙŠÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† 5000', desc: 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ø¯ÙŠÙˆÙ†Ù‡Ù… Ø£ÙƒØ«Ø± Ù…Ù† 5000' },
                { text: 'Ø¯ÙŠÙˆÙ† Ø¨ÙŠÙ† 1000 Ùˆ 5000', desc: 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ø¯ÙŠÙˆÙ†Ù‡Ù… Ø¨ÙŠÙ† 1000 Ùˆ 5000' },
                { text: 'ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹', desc: 'Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ø°ÙŠÙ† Ù„Ù… ÙŠØ³Ø¯Ø¯ÙˆØ§ Ø´ÙŠØ¦Ø§Ù‹' },
                { text: 'Ø¯ÙŠÙˆÙ† Ø¹Ø§Ù„ÙŠØ©', desc: 'Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ© (5000+)' }
            ];
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø§Øª ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ù‚ØµÙŠØ±Ø§Ù‹
            if (query.length < 3) {
                smartSearchResults.value = suggestions.map((suggestion, index) => ({
                    originalIndex: -1,
                    meterNumber: '',
                    name: suggestion.text,
                    remaining: 0,
                    paid: 0,
                    total: 0,
                    isSuggestion: true,
                    description: suggestion.desc
                }));
            }
        };
        
        // Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª
        const startVoiceRecognition = () => {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„ØµÙˆØªÙŠ. ÙŠØ±Ø¬Ù‰ Ø§Ø³ØªØ®Ø¯Ø§Ù… Chrome Ø£Ùˆ Edge.");
                return;
            }

            const recognition = new SpeechRecognition();
            recognition.lang = 'ar-SA';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;
            
            isRecording.value = true;
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                searchQuery.value = transcript;
                executeSmartSearch();
                isRecording.value = false;
                showSyncIndicator(`ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰: "${transcript}"`, 'info');
            };

            recognition.onerror = (event) => {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª:', event.error);
                isRecording.value = false;
                showSyncIndicator('ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª', 'error');
            };
            
            recognition.onend = () => {
                isRecording.value = false;
            };

            try {
                recognition.start();
                showSyncIndicator('Ø¬Ø§Ø±Ù Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹... ØªØ­Ø¯Ø« Ø§Ù„Ø¢Ù†', 'info');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª:', error);
                isRecording.value = false;
                showSyncIndicator('ØªØ¹Ø°Ø± Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª', 'error');
            }
        };
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙØ¦Ø© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©
        const getDebtLevelClass = (remaining) => {
            if (remaining >= 5000) return 'high';
            if (remaining >= 1000) return 'medium';
            return 'low';
        };
        
        // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„Ù…Ø­Ø¯Ø¯
        const scrollToRow = (rowIndex) => {
            if (rowIndex === -1) return;
            
            const tableContainer = document.querySelector('.table-container');
            const tableRows = document.querySelectorAll('.table-container tbody tr');
            
            if (tableRows[rowIndex]) {
                tableRows[rowIndex].scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
                
                // Ø¥Ø¨Ø±Ø§Ø² Ø§Ù„ØµÙ Ù…Ø¤Ù‚ØªØ§Ù‹
                tableRows[rowIndex].classList.add('highlighted');
                setTimeout(() => {
                    tableRows[rowIndex].classList.remove('highlighted');
                }, 2000);
            }
            
            showSearchResults.value = false;
        };
        
        // ============ Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ¶Ø¹ ============
        const changeTheme = (theme) => {
            currentTheme.value = theme;
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('waterSystem_theme', theme);
            showSyncIndicator(`ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ ${theme === 'normal' ? 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ' : theme === 'night' ? 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ' : 'Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†'}`, 'info');
        };
        
        const toggleFocusMode = () => {
            focusMode.value = !focusMode.value;
            if (focusMode.value) {
                document.body.classList.add('focus-mode');
                showSyncIndicator('ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ² - Ø³ÙŠØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©', 'info');
            } else {
                document.body.classList.remove('focus-mode');
                showSyncIndicator('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù ÙˆØ¶Ø¹ Ø§Ù„ØªØ±ÙƒÙŠØ²', 'info');
            }
            localStorage.setItem('waterSystem_focusMode', JSON.stringify(focusMode.value));
        };
        
        const loadThemeFromStorage = () => {
            const savedTheme = localStorage.getItem('waterSystem_theme');
            const savedFocusMode = localStorage.getItem('waterSystem_focusMode');
            
            if (savedTheme) {
                currentTheme.value = savedTheme;
                document.body.setAttribute('data-theme', savedTheme);
            }
            
            if (savedFocusMode) {
                focusMode.value = JSON.parse(savedFocusMode);
                if (focusMode.value) {
                    document.body.classList.add('focus-mode');
                }
            }
        };
        
        // ========== Ø¯ÙˆØ§Ù„ AI Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ==========
        
        // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
        const analyzeDataWithAI = () => {
            const analysis = {
                totalDebt: 0,
                totalRevenue: 0,
                totalPaid: 0,
                totalSubscribers: 0,
                activeSubscribers: 0,
                totalConsumption: 0,
                highRiskCount: 0,
                mediumRiskCount: 0,
                anomalies: [],
                patterns: [],
                predictions: []
            };
            
            if (villageData.value.length > 0) {
                villageData.value.forEach((row, index) => {
                    if (index < 2 || getRowClass(index, row) === 'total-row') return;
                    
                    const meterNumber = row[0];
                    const name = row[1];
                    const previousReading = parseFloat(row[2] || 0);
                    const currentReading = parseFloat(row[3] || 0);
                    const consumption = currentReading - previousReading;
                    const required = parseFloat(row[9] || 0);
                    const paid = parseFloat(row[11] || 0);
                    const remaining = parseFloat(row[12] || 0);
                    
                    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                    analysis.totalDebt += remaining;
                    analysis.totalRevenue += required;
                    analysis.totalPaid += paid;
                    analysis.totalSubscribers++;
                    
                    if (consumption > 0) {
                        analysis.activeSubscribers++;
                        analysis.totalConsumption += consumption;
                    }
                    
                    // ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ø®Ø§Ø·Ø±
                    if (remaining > 10000) {
                        analysis.highRiskCount++;
                        analysis.anomalies.push({
                            type: 'high_debt',
                            meterNumber,
                            name,
                            value: remaining,
                            message: `Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹: ${formatNumber(remaining)}`,
                            priority: 'high'
                        });
                    } else if (remaining > 5000) {
                        analysis.mediumRiskCount++;
                        analysis.anomalies.push({
                            type: 'medium_debt',
                            meterNumber,
                            name,
                            value: remaining,
                            message: `Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ù…ØªÙˆØ³Ø·Ø©: ${formatNumber(remaining)}`,
                            priority: 'medium'
                        });
                    }
                    
                    // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ØºÙŠØ± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ
                    if (consumption > 100 && consumption > 0) {
                        analysis.anomalies.push({
                            type: 'high_consumption',
                            meterNumber,
                            name,
                            value: consumption,
                            message: `Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…Ø±ØªÙØ¹: ${consumption} Ù…Â³`,
                            priority: 'medium'
                        });
                    }
                    
                    // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„ØªØ³Ø±Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„
                    if (remaining > 0 && paid === 0) {
                        analysis.patterns.push({
                            type: 'non_payer',
                            meterNumber,
                            name,
                            value: remaining,
                            message: `Ù„Ù… ÙŠØ³Ø¯Ø¯ Ù…Ù†Ø° ÙØªØ±Ø©: ${formatNumber(remaining)}`,
                            priority: 'high'
                        });
                    }
                    
                    // Ø§ÙƒØªØ´Ø§Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø·
                    if (remaining > required * 0.5) {
                        analysis.patterns.push({
                            type: 'high_debt_ratio',
                            meterNumber,
                            name,
                            value: (remaining / required * 100).toFixed(1),
                            message: `Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©: ${(remaining / required * 100).toFixed(1)}%`,
                            priority: 'medium'
                        });
                    }
                });
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨ ÙˆØ§Ù„Ù…ØªÙˆØ³Ø·Ø§Øª
                analysis.collectionRate = analysis.totalRevenue > 0 ? 
                    Math.round((analysis.totalPaid / analysis.totalRevenue) * 100) : 0;
                analysis.avgConsumption = analysis.activeSubscribers > 0 ? 
                    Math.round(analysis.totalConsumption / analysis.activeSubscribers) : 0;
                analysis.riskPercentage = analysis.totalSubscribers > 0 ? 
                    Math.round((analysis.highRiskCount / analysis.totalSubscribers) * 100) : 0;
                
                // ØªÙˆÙ„ÙŠØ¯ ØªÙ†Ø¨Ø¤Ø§Øª Ø¨Ø³ÙŠØ·Ø©
                analysis.predictions.push({
                    type: 'next_month_revenue',
                    value: Math.round(analysis.totalRevenue * (1 + (Math.random() * 0.2 - 0.1))),
                    confidence: 75,
                    message: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø© Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…'
                });
                
                analysis.predictions.push({
                    type: 'debt_growth',
                    value: Math.round(analysis.totalDebt * 0.1),
                    confidence: 80,
                    message: 'Ù†Ù…Ùˆ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹'
                });
            }
            
            return analysis;
        };
        
        // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª AI
        const updateAIStats = () => {
            if (villageData.value.length === 0) return;
            
            const analysis = analyzeDataWithAI();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            aiStats.value.totalDebt = analysis.totalDebt;
            aiStats.value.collectionRate = analysis.collectionRate;
            aiStats.value.avgConsumption = analysis.avgConsumption;
            aiStats.value.riskSubscribers = analysis.highRiskCount + analysis.mediumRiskCount;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª (Ù…Ø­Ø§ÙƒØ§Ø©)
            const trends = ['up', 'down', 'stable'];
            aiStats.value.debtTrend = trends[Math.floor(Math.random() * 3)];
            aiStats.value.collectionTrend = trends[Math.floor(Math.random() * 3)];
            aiStats.value.consumptionTrend = trends[Math.floor(Math.random() * 3)];
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ø³Ø¨ Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„ØªØºÙŠÙŠØ±
            aiStats.value.debtChange = Math.round(Math.random() * 20 - 10);
            aiStats.value.collectionChange = Math.round(Math.random() * 15 - 7);
            aiStats.value.consumptionChange = Math.round(Math.random() * 25 - 12);
            
            // ØªÙ‚ÙŠÙŠÙ… Ù…Ø³ØªÙˆÙ‰ Ø®Ø·ÙˆØ±Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª
            if (analysis.totalDebt > 1000000) {
                aiStats.value.debtRiskLevel = 'danger';
            } else if (analysis.totalDebt > 500000) {
                aiStats.value.debtRiskLevel = 'warning';
            } else {
                aiStats.value.debtRiskLevel = 'success';
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© AI
            aiStatus.value = analysis.highRiskCount > 10 ? 'ÙŠØ­ØªØ§Ø¬ Ø§Ù†ØªØ¨Ø§Ù‡' : 'Ù…Ø³ØªÙ‚Ø±';
            
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙˆØµÙŠØ§Øª
            generateAIRecommendations(analysis);
            
            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
            generateAIAlerts(analysis);
        };
        
        // ØªÙˆÙ„ÙŠØ¯ ØªÙˆØµÙŠØ§Øª AI
        const generateAIRecommendations = (analysis) => {
            const recommendations = [];
            const now = new Date();
            
            // Ø§Ù„ØªÙˆØµÙŠØ© 1: Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„
            if (analysis.collectionRate < 70) {
                recommendations.push({
                    title: 'ØªØ­Ø³ÙŠÙ† Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„',
                    description: `Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠØ© ${analysis.collectionRate}% Ù…Ù†Ø®ÙØ¶Ø©. ÙŠÙˆØµÙŠ Ø¨Ø²ÙŠØ§Ø¯Ø© Ø¬Ù‡ÙˆØ¯ Ø§Ù„ØªØ­ØµÙŠÙ„.`,
                    icon: 'fas fa-money-bill-wave',
                    priority: 'high',
                    timestamp: now
                });
            }
            
            // Ø§Ù„ØªÙˆØµÙŠØ© 2: Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
            if (analysis.highRiskCount > 5) {
                recommendations.push({
                    title: 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©',
                    description: `Ù‡Ù†Ø§Ùƒ ${analysis.highRiskCount} Ù…Ø´ØªØ±Ùƒ Ù„Ø¯ÙŠÙ‡Ù… Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø¹Ø§Ù„ÙŠØ© ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±ÙŠØ©.`,
                    icon: 'fas fa-exclamation-triangle',
                    priority: 'high',
                    timestamp: now
                });
            }
            
            // Ø§Ù„ØªÙˆØµÙŠØ© 3: Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ
            if (analysis.avgConsumption > 50) {
                recommendations.push({
                    title: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…Ø±ØªÙØ¹',
                    description: `Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ${analysis.avgConsumption} Ù…Â³ Ù…Ø±ØªÙØ¹. ÙŠÙˆØµÙŠ Ø¨Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„ØªØ³Ø±ÙŠØ¨Ø§Øª.`,
                    icon: 'fas fa-tint',
                    priority: 'medium',
                    timestamp: now
                });
            }
            
            // Ø§Ù„ØªÙˆØµÙŠØ© 4: Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª
            if (analysis.totalDebt > 500000) {
                recommendations.push({
                    title: 'Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„ÙƒÙ„ÙŠØ©',
                    description: `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª ${formatNumber(analysis.totalDebt)}. ÙŠÙˆØµÙŠ Ø¨ÙˆØ¶Ø¹ Ø®Ø·Ø© ØªÙ‚Ø³ÙŠØ·.`,
                    icon: 'fas fa-hand-holding-usd',
                    priority: 'medium',
                    timestamp: now
                });
            }
            
            // Ø§Ù„ØªÙˆØµÙŠØ© 5: ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„
            recommendations.push({
                title: 'ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ø´Ù‡Ø±ÙŠ',
                description: 'ÙŠÙˆØµÙŠ Ø¨Ø¹Ù…Ù„ ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„ Ø´Ù‡Ø±ÙŠ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„ØªØºÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ø£Ù†Ù…Ø§Ø·.',
                icon: 'fas fa-chart-line',
                priority: 'low',
                timestamp: now
            });
            
            aiRecommendations.value = recommendations.slice(0, 4); // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 4 ØªÙˆØµÙŠØ§Øª ÙÙ‚Ø·
        };
        
        // ØªÙˆÙ„ÙŠØ¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª AI
        const generateAIAlerts = (analysis) => {
            const alerts = [];
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-SA', { hour: '2-digit', minute: '2-digit' });
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ø°ÙˆØ°
            analysis.anomalies.forEach(anomaly => {
                if (anomaly.priority === 'high') {
                    alerts.push({
                        title: `ØªÙ†Ø¨ÙŠÙ‡: ${anomaly.type === 'high_debt' ? 'Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø­Ø±Ø¬Ø©' : 'Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ'}`,
                        description: `${anomaly.message} - ${anomaly.name}`,
                        type: 'danger',
                        icon: 'fas fa-exclamation-circle',
                        time: timeString,
                        priority: 'high'
                    });
                }
            });
            
            // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø£Ù†Ù…Ø§Ø·
            analysis.patterns.forEach(pattern => {
                if (pattern.priority === 'high') {
                    alerts.push({
                        title: `Ù†Ù…Ø· Ù…Ù‚Ù„Ù‚: ${pattern.type === 'non_payer' ? 'ØªØ£Ø®Ø± ÙÙŠ Ø§Ù„Ø³Ø¯Ø§Ø¯' : 'Ù†Ø³Ø¨Ø© Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©'}`,
                        description: `${pattern.message} - ${pattern.name}`,
                        type: 'warning',
                        icon: 'fas fa-clock',
                        time: timeString,
                        priority: 'medium'
                    });
                }
            });
            
            // ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø¹Ø§Ù…Ø©
            if (analysis.collectionRate < 60) {
                alerts.push({
                    title: 'Ø§Ù†Ø®ÙØ§Ø¶ Ø­Ø§Ø¯ ÙÙŠ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„',
                    description: `Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„ ${analysis.collectionRate}% ÙÙ‚Ø·. ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø³ÙŠÙ† Ø¹Ø§Ø¬Ù„.`,
                    type: 'danger',
                    icon: 'fas fa-chart-line',
                    time: timeString,
                    priority: 'high'
                });
            }
            
            if (analysis.highRiskCount > 10) {
                alerts.push({
                    title: 'Ø¹Ø¯Ø¯ ÙƒØ¨ÙŠØ± Ù…Ù† Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø¹Ø§Ù„ÙŠÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±',
                    description: `${analysis.highRiskCount} Ù…Ø´ØªØ±Ùƒ ÙŠØ­ØªØ§Ø¬ÙˆÙ† Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±ÙŠØ©.`,
                    type: 'warning',
                    icon: 'fas fa-users',
                    time: timeString,
                    priority: 'high'
                });
            }
            
            // ØªÙ†Ø¨ÙŠÙ‡ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ
            if (alerts.length === 0) {
                alerts.push({
                    title: 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø±Ø¬Ø©',
                    description: 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø¶Ù…Ù† Ø§Ù„Ù…Ø¹Ø¯Ù„Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©.',
                    type: 'info',
                    icon: 'fas fa-check-circle',
                    time: timeString,
                    priority: 'low'
                });
            }
            
            aiAlerts.value = alerts.slice(0, 5); // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 5 ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙÙ‚Ø·
        };
        
        // ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ AI
        const refreshAIAnalysis = () => {
            showSmartLoading('ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ', 'Ø¬Ø§Ø±Ù ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ...', 'fas fa-brain');
            
            setTimeout(() => {
                updateAIStats();
                hideSmartLoading();
                showSyncIndicator('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'ai');
            }, 1500);
        };
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø¸Ù‡ÙˆØ±/Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© AI
        const toggleAIPanel = () => {
            aiPanelVisible.value = !aiPanelVisible.value;
            
            if (aiPanelVisible.value) {
                updateAIStats();
                showSyncIndicator('ØªÙ… Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', 'ai');
            } else {
                showSyncIndicator('ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', 'info');
            }
        };
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø¸Ù‡ÙˆØ±/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        const toggleCharts = () => {
            chartsVisible.value = !chartsVisible.value;
            
            if (chartsVisible.value) {
                // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø±
                const chartBtn = document.querySelector('.chart-toggle-btn i');
                if (chartBtn) {
                    chartBtn.className = 'fas fa-eye-slash';
                }
                const chartText = document.querySelector('.chart-toggle-btn');
                if (chartText) {
                    chartText.innerHTML = '<i class="fas fa-eye-slash"></i> Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ…';
                }
                
                // Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                nextTick(() => {
                    initializeCharts();
                });
                showSyncIndicator('ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©', 'info');
            } else {
                // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø±
                const chartBtn = document.querySelector('.chart-toggle-btn i');
                if (chartBtn) {
                    chartBtn.className = 'fas fa-chart-bar';
                }
                const chartText = document.querySelector('.chart-toggle-btn');
                if (chartText) {
                    chartText.innerHTML = '<i class="fas fa-chart-bar"></i> Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³ÙˆÙ…';
                }
                
                showSyncIndicator('ØªÙ… Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©', 'info');
            }
        };
        
        // ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± AI
        const generateAIReport = () => {
            showSmartLoading('ØªÙˆÙ„ÙŠØ¯ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒÙŠ', 'Ø¬Ø§Ø±Ù Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± ØªØ­Ù„ÙŠÙ„ Ù…ÙØµÙ„...', 'fas fa-file-medical-alt');
            
            setTimeout(() => {
                const analysis = analyzeDataWithAI();
                
                // Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù†ØµÙŠ
                const report = `
ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - ${selectedVillage.value} - ${selectedMonth.value}
================================================
ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙˆÙ„ÙŠØ¯: ${new Date().toLocaleDateString('ar-SA')}

ğŸ“Š **Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©:**
â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª: ${formatNumber(analysis.totalDebt)}
â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„: ${analysis.collectionRate}%
â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ: ${formatNumber(analysis.avgConsumption)} Ù…Â³
â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†: ${analysis.totalSubscribers}
â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†: ${analysis.activeSubscribers}

âš ï¸ **Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª:**
${analysis.anomalies.length > 0 ? analysis.anomalies.map(a => `â€¢ ${a.message}`).join('\n') : 'â€¢ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø±Ø¬Ø©'}

ğŸ’¡ **Ø§Ù„ØªÙˆØµÙŠØ§Øª:**
1. ${aiRecommendations.value[0]?.description || 'ØªØ­Ø³ÙŠÙ† Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ØµÙŠÙ„'}
2. ${aiRecommendations.value[1]?.description || 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©'}
3. ${aiRecommendations.value[2]?.description || 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ'}

ğŸ“ˆ **Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª:**
${analysis.predictions.map(p => `â€¢ ${p.message}: ${formatNumber(p.value)} (Ø«Ù‚Ø©: ${p.confidence}%)`).join('\n')}

---
ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨ÙˆØ§Ø³Ø·Ø© Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                `;
                
                // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ± ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©
                const reportWindow = window.open('', 'ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ', 'width=800,height=600');
                reportWindow.document.write(`
                    <html dir="rtl">
                    <head>
                        <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</title>
                        <style>
                            body { font-family: 'Tajawal', sans-serif; padding: 20px; background: #f5f7fa; }
                            .report-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
                            h1 { color: #8a2be2; text-align: center; }
                            .section { margin: 25px 0; padding: 20px; background: #f8f9fa; border-radius: 10px; }
                            .alert { color: #dc3545; font-weight: bold; }
                            .recommendation { color: #20b2aa; }
                            /* Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ */
.install-banner {
    display: none;
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #4cc9f0, #4361ee);
    color: white;
    padding: 12px 25px;
    border-radius: 50px;
    box-shadow: 0 10px 20px rgba(0,0,0,0.2);
    z-index: 9999;
    cursor: pointer;
    font-family: 'Tajawal', sans-serif;
    border: 2px solid rgba(255,255,255,0.3);
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);}
    40% {transform: translateX(-50%) translateY(-10px);}
    60% {transform: translateX(-50%) translateY(-5px);}
}
                        </style>
                    </head>
                    <body>
                        <div class="report-container">
                            <h1>ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h1>
                            <div style="white-space: pre-line; font-size: 16px; line-height: 1.8;">
                                ${report}
                            </div>
                            <div style="text-align: center; margin-top: 30px;">
                                <button onclick="window.print()" style="padding: 10px 20px; background: #8a2be2; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                    Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                                </button>
                            </div>
                        </div>
                    </body>
                    </html>
                `);
                
                hideSmartLoading();
                showSyncIndicator('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø¨Ù†Ø¬Ø§Ø­', 'ai');
            }, 2000);
        };
        
        // Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª
        const showDebtAnalysis = () => {
            const analysis = analyzeDataWithAI();
            alert(`ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª - ${selectedVillage.value}\n\n` +
                  `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª: ${formatNumber(analysis.totalDebt)}\n` +
                  `â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©: ${formatNumber(analysis.totalDebt / analysis.totalSubscribers)}\n` +
                  `â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø¹Ø§Ù„ÙŠÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ${analysis.highRiskCount}\n` +
                  `â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù…ØªÙˆØ³Ø·ÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ${analysis.mediumRiskCount}\n` +
                  `â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®Ø·ÙˆØ±Ø©: ${analysis.riskPercentage}%\n\n` +
                  `ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ©: ${analysis.highRiskCount > 0 ? 
                    'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø¹Ø§Ù„ÙŠÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø± ÙÙˆØ±Ø§Ù‹' : 
                    'Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª ØªØ­Øª Ø§Ù„Ø³ÙŠØ·Ø±Ø©'}`);
        };
        
        // Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª
        const showRevenueAnalysis = () => {
            const analysis = analyzeDataWithAI();
            alert(`ğŸ“ˆ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª - ${selectedVillage.value}\n\n` +
                  `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø³ØªØ­Ù‚Ø©: ${formatNumber(analysis.totalRevenue)}\n` +
                  `â€¢ Ø§Ù„Ù…ØªØ­ØµÙ„ ÙØ¹Ù„ÙŠØ§Ù‹: ${formatNumber(analysis.totalPaid)}\n` +
                  `â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­ØµÙŠÙ„: ${analysis.collectionRate}%\n` +
                  `â€¢ Ø§Ù„ÙØ¬ÙˆØ© Ø§Ù„ØªØ¬Ù…ÙŠØ¹ÙŠØ©: ${formatNumber(analysis.totalRevenue - analysis.totalPaid)}\n` +
                  `â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¯ÙØ¹: ${formatNumber(analysis.totalPaid / analysis.activeSubscribers)}\n\n` +
                  `ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ©: ${analysis.collectionRate < 80 ? 
                    'ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ© Ø§Ù„ØªØ­ØµÙŠÙ„ Ù„Ø±ÙØ¹ Ø§Ù„Ù†Ø³Ø¨Ø©' : 
                    'Ù…Ø¹Ø¯Ù„ ØªØ­ØµÙŠÙ„ Ù…Ù…ØªØ§Ø²'}`);
        };
        
        // Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ
        const showConsumptionAnalysis = () => {
            const analysis = analyzeDataWithAI();
            alert(`ğŸ’§ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ - ${selectedVillage.value}\n\n` +
                  `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ: ${formatNumber(analysis.totalConsumption)} Ù…Â³\n` +
                  `â€¢ Ù…ØªÙˆØ³Ø· Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ: ${formatNumber(analysis.avgConsumption)} Ù…Â³\n` +
                  `â€¢ Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†: ${analysis.activeSubscribers}\n` +
                  `â€¢ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ØºÙŠØ± Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ: ${analysis.anomalies.filter(a => a.type === 'high_consumption').length}\n` +
                  `â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø´Ø§Ø·: ${Math.round((analysis.activeSubscribers / analysis.totalSubscribers) * 100)}%\n\n` +
                  `ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ©: ${analysis.avgConsumption > 50 ? 
                    'Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ù…ÙŠØ§Ù‡ ÙˆØ±ÙØ¹ Ø§Ù„ØªÙˆØ¹ÙŠØ© Ø¨Ø§Ù„ØªØ±Ø´ÙŠØ¯' : 
                    'Ù…Ø¹Ø¯Ù„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ù…Ø¹Ù‚ÙˆÙ„'}`);
        };
        
        // Ø¹Ø±Ø¶ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø±
        const showRiskAnalysis = () => {
            const analysis = analyzeDataWithAI();
            alert(`âš ï¸ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ø·Ø± - ${selectedVillage.value}\n\n` +
                  `â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø¹Ø§Ù„ÙŠÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ${analysis.highRiskCount}\n` +
                  `â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù…ØªÙˆØ³Ø·ÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ${analysis.mediumRiskCount}\n` +
                  `â€¢ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ù…Ø¹Ø±Ø¶Ø©: ${formatNumber(analysis.totalDebt)}\n` +
                  `â€¢ Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø®Ø§Ø·Ø±: ${analysis.riskPercentage}%\n` +
                  `â€¢ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø§Ù„Ù…ØªØ£Ø®Ø±ÙŠÙ†: ${analysis.patterns.filter(p => p.type === 'non_payer').length}\n\n` +
                  `ğŸ’¡ Ø§Ù„ØªÙˆØµÙŠØ©: ${analysis.highRiskCount > 5 ? 
                    'ÙˆØ¶Ø¹ Ø®Ø·Ø© Ø·ÙˆØ§Ø±Ø¦ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ø¹Ø§Ù„ÙŠÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±' : 
                    'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø®Ø§Ø·Ø±Ø© Ù…Ù‚Ø¨ÙˆÙ„'}`);
        };
        
        // Ø¹Ø±Ø¶ Ø±Ø¤Ù‰ AI
        const showAIInsights = () => {
            const analysis = analyzeDataWithAI();
            
            const insights = `
ğŸ”® **Ø±Ø¤Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - ${selectedVillage.value}**

ğŸ“Š **Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:**
â€¢ ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªØ­ØµÙŠÙ„: ${analysis.collectionRate >= 80 ? 'Ù…Ù…ØªØ§Ø²Ø©' : analysis.collectionRate >= 60 ? 'Ø¬ÙŠØ¯Ø©' : 'ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'}
â€¢ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª: ${analysis.totalDebt > 1000000 ? 'Ø­Ø±Ø¬Ø©' : analysis.totalDebt > 500000 ? 'ØªØ­Øª Ø§Ù„Ø³ÙŠØ·Ø±Ø©' : 'Ù…Ù…ØªØ§Ø²Ø©'}
â€¢ ÙƒÙØ§Ø¡Ø© Ø§Ù„ØªØ´ØºÙŠÙ„: ${analysis.avgConsumption > 50 ? 'Ù…Ø±ØªÙØ¹Ø©' : 'Ù…Ø¹Ù‚ÙˆÙ„Ø©'}

ğŸ¯ **Ù†Ù‚Ø§Ø· Ø§Ù„ØªØ±ÙƒÙŠØ²:**
1. ${analysis.highRiskCount > 0 ? `Ù…ØªØ§Ø¨Ø¹Ø© ${analysis.highRiskCount} Ù…Ø´ØªØ±Ùƒ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®Ø§Ø·Ø±` : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ø·Ø± Ø¹Ø§Ù„ÙŠØ©'}
2. ${analysis.collectionRate < 80 ? 'ØªØ­Ø³ÙŠÙ† Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ­ØµÙŠÙ„' : 'Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ'}
3. ${analysis.anomalies.length > 0 ? 'Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø´Ø§Ø°Ø©' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø§Ù„Ø§Øª Ø´Ø§Ø°Ø©'}

ğŸ’¡ **Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ø°ÙƒÙŠØ©:**
${analysis.predictions.map(p => `â€¢ ${p.message}: ${formatNumber(p.value)} (${p.confidence}% Ø«Ù‚Ø©)`).join('\n')}

ğŸŒŸ **Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø¹Ø§Ù…:**
${analysis.collectionRate >= 80 && analysis.totalDebt < 500000 ? 'Ø£Ø¯Ø§Ø¡ Ù…Ù…ØªØ§Ø²' : 
  analysis.collectionRate >= 70 && analysis.totalDebt < 1000000 ? 'Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯' : 
  'Ø£Ø¯Ø§Ø¡ ÙŠØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†'}
            `;
            
            alert(insights);
        };
        
        // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ ==========
        
        // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
        const fetchMonthlyReportData = async () => {
            monthlyReportLoading.value = true;
            try {
                const response = await fetch(MONTHLY_REPORT_URL);
                const data = await response.json();
                monthlyReportData.value = data;
                
                const months = Object.keys(data).filter(m => m !== 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ');
                if (!currentReportMonth.value) currentReportMonth.value = months[0] || 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ';
                
                monthlyReportLastUpdated.value = new Date().toLocaleTimeString('ar-EG');
                showSyncIndicator('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ', 'success');
            } catch (error) {
                console.error("Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ:", error);
                showSyncIndicator('ÙØ´Ù„ ÙÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ', 'error');
            } finally {
                monthlyReportLoading.value = false;
            }
        };
        
        // Ø±Ø¤ÙˆØ³ Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
        const monthlyReportHeaders = computed(() => {
            const data = monthlyReportData.value[currentReportMonth.value];
            return data ? data[1] : [];
        });
        
        // Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ù…ØµÙØ§Ø© Ù„Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
        const filteredMonthlyReportRows = computed(() => {
            const data = monthlyReportData.value[currentReportMonth.value];
            if (!data) return [];
            
            const allRows = data.slice(2); 
            
            if (!monthlyReportSearchTerm.value) return allRows;

            return allRows.filter(row => 
                row.some(cell => 
                    String(cell).toLowerCase().includes(monthlyReportSearchTerm.value.toLowerCase())
                )
            );
        });
        
        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
        const monthlyReportStats = computed(() => {
            const months = Object.keys(monthlyReportData.value).filter(m => m !== 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ');
            const lastMonth = months[months.length - 1];
            const data = monthlyReportData.value[lastMonth] || [];
            const lastRow = data[data.length - 1] || [];

            return {
                villageCount: data.length > 3 ? data.length - 3 : 0,
                monthCount: months.length,
                totalRemaining: lastRow[10] || 0
            };
        });
        
        // ØªØ­Ø¯ÙŠØ¯ ÙØ¦Ø© Ø®Ù„ÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        const getReportCellClass = (val, cellIdx, rowIndex) => {
            if (typeof val !== 'number') return '';
            // Ù„Ø§ Ù†Ø·Ø¨Ù‚ ØªÙ„ÙˆÙŠÙ† "Ø£Ø®Ø¶Ø±/Ø£Ø­Ù…Ø±" Ø¹Ù„Ù‰ Ø§Ù„ØµÙ Ø§Ù„Ø£Ø®ÙŠØ±
            const isLastRow = rowIndex === filteredMonthlyReportRows.value.length - 1 && !monthlyReportSearchTerm.value;
            if (isLastRow) return '';

            if ([2, 3, 4, 9, 10].includes(cellIdx)) {
                return val > 0 ? 'report-positive' : val < 0 ? 'report-negative' : '';
            }
            return '';
        };
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø®Ù„ÙŠØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
        const formatReportCell = (val) => {
            return typeof val === 'number' ? formatNumber(val) : val;
        };
        
        // ========== Ù†Ù‡Ø§ÙŠØ© Ø¯ÙˆØ§Ù„ AI ==========
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
        const highDebtAlerts = computed(() => {
            const alerts = [];
            
            if (villageData.value.length > 0) {
                villageData.value.forEach((row, index) => {
                    if (index === 0 || index === 1 || getRowClass(index, row) === 'total-row') return;
                    
                    const remaining = parseFloat(row[12] || 0);
                    
                    if (!isNaN(remaining) && remaining >= 5000) {
                        alerts.push({
                            index: index,
                            meterNumber: row[0] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                            name: row[1] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                            remaining: remaining,
                            paid: parseFloat(row[11] || 0),
                            total: parseFloat(row[9] || 0),
                            rowData: row
                        });
                    }
                });
            }
            
            return alerts.sort((a, b) => b.remaining - a.remaining);
        });

        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
        const totalHighDebt = computed(() => {
            return highDebtAlerts.value.reduce((sum, debt) => sum + debt.remaining, 0);
        });

        const highestDebtAmount = computed(() => {
            if (highDebtAlerts.value.length === 0) return 0;
            return Math.max(...highDebtAlerts.value.map(d => d.remaining));
        });

        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const chartStats = computed(() => {
            const stats = {
                totalRevenue: 0,
                totalPaid: 0,
                totalRemaining: 0,
                highDebtCount: 0,
                mediumDebtCount: 0,
                lowDebtCount: 0,
                totalConsumption: 0,
                averageConsumption: 0,
                highestConsumption: 0,
                lowestConsumption: Infinity,
                consumptionData: [],
                debtData: []
            };
            
            if (villageData.value.length > 0) {
                villageData.value.forEach((row, index) => {
                    if (index === 0 || index === 1 || getRowClass(index, row) === 'total-row') return;
                    
                    const required = parseFloat(row[9] || 0);
                    const paid = parseFloat(row[11] || 0);
                    const remaining = parseFloat(row[12] || 0);
                    
                    stats.totalRevenue += required || 0;
                    stats.totalPaid += paid || 0;
                    stats.totalRemaining += remaining || 0;
                    
                    if (remaining > 5000) {
                        stats.highDebtCount++;
                    } else if (remaining > 1000) {
                        stats.mediumDebtCount++;
                    } else if (remaining > 0) {
                        stats.lowDebtCount++;
                    }
                    
                    const currentReading = parseFloat(row[3] || 0);
                    const previousReading = parseFloat(row[2] || 0);
                    const consumption = currentReading - previousReading;
                    
                    if (!isNaN(consumption) && consumption > 0) {
                        stats.totalConsumption += consumption;
                        stats.consumptionData.push({
                            name: row[1] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                            consumption: consumption
                        });
                        
                        stats.highestConsumption = Math.max(stats.highestConsumption, consumption);
                        stats.lowestConsumption = Math.min(stats.lowestConsumption, consumption);
                    }
                    
                    if (remaining > 0) {
                        stats.debtData.push({
                            name: row[1] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ',
                            debt: remaining
                        });
                    }
                });
                
                const validRows = villageData.value.length - 3;
                if (validRows > 0) {
                    stats.averageConsumption = stats.totalConsumption / validRows;
                    stats.lowestConsumption = stats.lowestConsumption === Infinity ? 0 : stats.lowestConsumption;
                }
            }
            
            return stats;
        });

        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø¹Ø¨Ø± Ø§Ù„Ø£Ø´Ù‡Ø±
        const monthlyStats = computed(() => {
            const months = ['Ø´Ù‡Ø± 1', 'Ø´Ù‡Ø± 2', 'Ø´Ù‡Ø± 3', 'Ø´Ù‡Ø± 4', 'Ø´Ù‡Ø± 5', 'Ø´Ù‡Ø± 6'];
            const revenues = [25000, 30000, 28000, 32000, 31000, 35000];
            const paid = [20000, 25000, 23000, 28000, 27000, 30000];
            
            const maxRevenue = Math.max(...revenues);
            const bestMonthIndex = revenues.indexOf(maxRevenue);
            
            return {
                months,
                revenues,
                paid,
                bestMonth: months[bestMonthIndex],
                bestMonthRevenue: maxRevenue
            };
        });

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø°Ø§ÙƒØ±Ø©
        const formatNumber = (num) => {
            if (isNaN(num)) return '0';
            return new Intl.NumberFormat('ar-SA').format(Math.round(num));
        };

        const formatTimeAgo = (timestamp) => {
            const diff = Date.now() - timestamp;
            const minutes = Math.floor(diff / 60000);
            
            if (minutes < 1) return 'Ø§Ù„Ø¢Ù†';
            if (minutes < 60) return `Ù‚Ø¨Ù„ ${minutes} Ø¯Ù‚ÙŠÙ‚Ø©`;
            
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `Ù‚Ø¨Ù„ ${hours} Ø³Ø§Ø¹Ø©`;
            
            const days = Math.floor(hours / 24);
            return `Ù‚Ø¨Ù„ ${days} ÙŠÙˆÙ…`;
        };

        // Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const compressData = (data) => {
            if (!memoryManager.value.compressionEnabled) return data;
            
            try {
                const compressed = JSON.parse(JSON.stringify(data));
                
                if (Array.isArray(compressed)) {
                    compressed.forEach(row => {
                        if (Array.isArray(row)) {
                            row.forEach((cell, index) => {
                                if (typeof cell === 'number' && cell > 1000) {
                                    row[index] = Math.round(cell);
                                }
                            });
                        }
                    });
                }
                
                return compressed;
            } catch (error) {
                console.warn('ÙØ´Ù„ Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©:', error);
                return data;
            }
        };

        // ÙÙƒ Ø¶ØºØ· Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const decompressData = (data) => {
            return data;
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø®Ù„Ø§ÙŠØ§ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
        const isHighDebtCell = (rowIndex, cellIndex, cell, row) => {
            if (cellIndex !== 12) return false;
            if (rowIndex === 0 || rowIndex === 1 || getRowClass(rowIndex, row) === 'total-row') return false;
            
            const remaining = parseFloat(cell || 0);
            return !isNaN(remaining) && remaining >= 5000;
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ØµÙ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©
        const hasHighDebt = (rowIndex, row) => {
            if (rowIndex === 0 || rowIndex === 1 || getRowClass(rowIndex, row) === 'total-row') return false;
            
            const remaining = parseFloat(row[12] || 0);
            return !isNaN(remaining) && remaining >= 5000;
        };

        // Ø¯Ø§Ù„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
        const getCurrentMonth = () => {
            const now = new Date();
            const currentMonthNumber = now.getMonth() + 1;
            return `Ø´Ù‡Ø± ${currentMonthNumber}`;
        };

        // Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
        const currentMonth = ref(getCurrentMonth());

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø©
        setInterval(() => {
            currentMonth.value = getCurrentMonth();
        }, 3600000);

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
        const updateTimeAndDate = () => {
            const now = new Date();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª
            time.value = now.toLocaleTimeString("ar-SA", {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ§Ø±ÙŠØ®
            const arabicDays = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
            const arabicMonths = [
                'ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ',
                'ÙŠÙˆÙ„ÙŠÙˆ', 'Ø£ØºØ³Ø·Ø³', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'
            ];
            
            todayDate.value = `${now.getDate()} ${arabicMonths[now.getMonth()]} ${now.getFullYear()}`;
            todayDay.value = arabicDays[now.getDay()];
        };

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
        setInterval(updateTimeAndDate, 1000);

        // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø°ÙƒÙŠ
        const showSmartLoading = (title, message, icon = 'fas fa-sync-alt') => {
            smartLoading.value = {
                show: true,
                title,
                message,
                icon,
                progress: 0,
                hint: 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹...'
            };
        };

        const hideSmartLoading = () => {
            smartLoading.value.show = false;
        };

        const updateSmartLoading = (progress, message, hint = '') => {
            smartLoading.value.progress = progress;
            if (message) smartLoading.value.message = message;
            if (hint) smartLoading.value.hint = hint;
        };

        // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø± Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
        const showSyncIndicator = (message, type = 'info') => {
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle',
                ai: 'fas fa-robot'
            };
            
            syncIndicator.value = {
                show: true,
                type,
                message,
                icon: icons[type] || 'fas fa-info-circle'
            };
            
            setTimeout(() => {
                syncIndicator.value.show = false;
            }, type === 'error' ? 5000 : 3000);
        };

        // ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        const optimizeMemory = () => {
            showSmartLoading('ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°Ø§ÙƒØ±Ø©', 'Ø¬Ø§Ø±Ù ØªØ­Ø³ÙŠÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°Ø§ÙƒØ±Ø©...', 'fas fa-microchip');
            
            setTimeout(() => {
                const now = Date.now();
                const maxAge = 24 * 60 * 60 * 1000;
                
                for (const key in dataCache.value.lastSynced) {
                    if (now - dataCache.value.lastSynced[key] > maxAge) {
                        const [village, month] = key.split('_');
                        if (dataCache.value.villageData[village] && dataCache.value.villageData[village][month]) {
                            delete dataCache.value.villageData[village][month];
                        }
                        delete dataCache.value.lastSynced[key];
                    }
                }
                
                if (backupHistory.value.length > 5) {
                    backupHistory.value = backupHistory.value.slice(-5);
                }
                
                for (const village in dataCache.value.villageData) {
                    for (const month in dataCache.value.villageData[village]) {
                        dataCache.value.villageData[village][month] = 
                            compressData(dataCache.value.villageData[village][month]);
                    }
                }
                
                memoryManager.value.lastCleanup = Date.now();
                updateMemoryMetadata();
                
                hideSmartLoading();
                showSyncIndicator('ØªÙ… ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                
                saveCacheToStorage();
            }, 1000);
        };

        // Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´
        const clearMemoryCache = () => {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹ØŸ Ù‡Ø°Ø§ Ù„Ø§ ÙŠØ¤Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©.')) {
                showSmartLoading('Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©', 'Ø¬Ø§Ø±Ù Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©...', 'fas fa-trash');
                
                setTimeout(() => {
                    const pendingChangesBackup = JSON.parse(JSON.stringify(dataCache.value.pendingChanges));
                    
                    dataCache.value = {
                        villageData: {},
                        pendingChanges: pendingChangesBackup,
                        lastSynced: {},
                        backup: {},
                        metadata: {
                            size: 0,
                            items: 0,
                            lastUpdated: Date.now()
                        }
                    };
                    
                    isCachedData.value = false;
                    loadData(true, false);
                    
                    hideSmartLoading();
                    showSyncIndicator('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
                    
                    saveCacheToStorage();
                }, 1500);
            }
        };

        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        const updateMemoryMetadata = () => {
            const cacheSize = JSON.stringify(dataCache.value).length;
            let itemCount = 0;
            
            for (const village in dataCache.value.villageData) {
                itemCount += Object.keys(dataCache.value.villageData[village]).length;
            }
            
            dataCache.value.metadata = {
                size: cacheSize,
                items: itemCount,
                lastUpdated: Date.now()
            };
        };

        // Ø­ÙØ¸ Ø§Ù„ÙƒØ§Ø´ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        const saveCacheToStorage = () => {
            try {
                updateMemoryMetadata();
                localStorage.setItem('waterSystem_advancedCache', JSON.stringify(dataCache.value));
                localStorage.setItem('waterSystem_memoryManager', JSON.stringify(memoryManager.value));
                localStorage.setItem('waterSystem_aiPanelVisible', JSON.stringify(aiPanelVisible.value));
                localStorage.setItem('waterSystem_chartsVisible', JSON.stringify(chartsVisible.value));
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ÙƒØ§Ø´:', error);
                if (error.name === 'QuotaExceededError') {
                    optimizeMemory();
                }
            }
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ø´ Ù…Ù† Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        const loadCacheFromStorage = () => {
            try {
                const savedCache = localStorage.getItem('waterSystem_advancedCache');
                const savedManager = localStorage.getItem('waterSystem_memoryManager');
                const savedAiPanel = localStorage.getItem('waterSystem_aiPanelVisible');
                const savedChartsVisible = localStorage.getItem('waterSystem_chartsVisible');
                const savedTheme = localStorage.getItem('waterSystem_theme');
                const savedFocusMode = localStorage.getItem('waterSystem_focusMode');
                
                if (savedCache) {
                    dataCache.value = JSON.parse(savedCache);
                    updatePendingChangesCount();
                }
                
                if (savedManager) {
                    memoryManager.value = JSON.parse(savedManager);
                }
                
                if (savedAiPanel) {
                    aiPanelVisible.value = JSON.parse(savedAiPanel);
                }
                
                if (savedChartsVisible) {
                    chartsVisible.value = JSON.parse(savedChartsVisible);
                    
                    // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø²Ø± Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
                    if (chartsVisible.value) {
                        setTimeout(() => {
                            const chartBtn = document.querySelector('.chart-toggle-btn i');
                            if (chartBtn) {
                                chartBtn.className = 'fas fa-eye-slash';
                            }
                            const chartText = document.querySelector('.chart-toggle-btn');
                            if (chartText) {
                                chartText.innerHTML = '<i class="fas fa-eye-slash"></i> Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³ÙˆÙ…';
                            }
                        }, 100);
                    }
                }
                
                if (savedTheme) {
                    currentTheme.value = savedTheme;
                    document.body.setAttribute('data-theme', savedTheme);
                }
                
                if (savedFocusMode) {
                    focusMode.value = JSON.parse(savedFocusMode);
                    if (focusMode.value) {
                        document.body.classList.add('focus-mode');
                    }
                }
                
                const cleanupThreshold = 30 * 60 * 1000;
                if (Date.now() - memoryManager.value.lastCleanup > cleanupThreshold) {
                    setTimeout(optimizeMemory, 5000);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒØ§Ø´:', error);
            }
        };

        const fullscreenChart = (chartId) => {
            fullscreenChartId.value = chartId;
            nextTick(() => {
                renderFullscreenChart(chartId);
            });
        };

        const closeFullscreen = () => {
            fullscreenChartId.value = '';
        };

        // Ø±Ø³Ù… Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        const revenueChart = ref(null);
        const debtChart = ref(null);
        const consumptionChart = ref(null);
        const monthlyChart = ref(null);
        
        // Ù†Ø³Ø® Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
        const revenueChartFullscreen = ref(null);
        const debtChartFullscreen = ref(null);
        const consumptionChartFullscreen = ref(null);
        const monthlyChartFullscreen = ref(null);

        const initializeCharts = () => {
            if (chartInstances.value.revenue) chartInstances.value.revenue.destroy();
            if (chartInstances.value.debt) chartInstances.value.debt.destroy();
            if (chartInstances.value.consumption) chartInstances.value.consumption.destroy();
            if (chartInstances.value.monthly) chartInstances.value.monthly.destroy();
            
            renderRevenueChart();
            renderDebtChart();
            renderConsumptionChart();
            renderMonthlyChart();
        };

        const renderRevenueChart = () => {
            const ctx = revenueChart.value?.getContext('2d');
            if (!ctx) return;
            
            const data = {
                labels: ['Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'Ø§Ù„Ù…Ø³Ù„Ù…', 'Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ'],
                datasets: [{
                    label: 'Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª',
                    data: [
                        chartStats.value.totalRevenue,
                        chartStats.value.totalPaid,
                        chartStats.value.totalRemaining
                    ],
                    backgroundColor: ['#667eea', '#00b09b', '#ff416c'],
                    borderColor: ['#667eea', '#00b09b', '#ff416c'].map(c => c.replace('0.8', '1')),
                    borderWidth: 2
                }]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        rtl: true,
                        labels: {
                            font: {
                                family: 'Tajawal',
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        rtl: true,
                        callbacks: {
                            label: (context) => {
                                return `${context.dataset.label}: ${formatNumber(context.raw)}`;
                            }
                        }
                    }
                },
                scales: chartTypes.value.revenue === 'bar' ? {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (value) => formatNumber(value)
                        }
                    }
                } : {}
            };
            
            chartInstances.value.revenue = new Chart(ctx, {
                type: chartTypes.value.revenue,
                data: data,
                options: options
            });
        };

        const renderDebtChart = () => {
            const ctx = debtChart.value?.getContext('2d');
            if (!ctx) return;
            
            const data = {
                labels: ['Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ© (>5000)', 'Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ù…ØªÙˆØ³Ø·Ø© (1000-5000)', 'Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ù‚Ù„ÙŠÙ„Ø© (<1000)'],
                datasets: [{
                    label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ†',
                    data: [
                        chartStats.value.highDebtCount,
                        chartStats.value.mediumDebtCount,
                        chartStats.value.lowDebtCount
                    ],
                    backgroundColor: ['#ff416c', '#f7971e', '#00b09b'],
                    borderColor: ['#ff416c', '#f7971e', '#00b09b'].map(c => c.replace('0.8', '1')),
                    borderWidth: 2
                }]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        rtl: true,
                        labels: {
                            font: {
                                family: 'Tajawal',
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        rtl: true,
                        callbacks: {
                            label: (context) => {
                                return `${context.label}: ${context.raw} Ù…Ø´ØªØ±Ùƒ`;
                            }
                        }
                    }
                }
            };
            
            chartInstances.value.debt = new Chart(ctx, {
                type: chartTypes.value.debt,
                data: data,
                options: options
            });
        };

        const renderConsumptionChart = () => {
            const ctx = consumptionChart.value?.getContext('2d');
            if (!ctx) return;
            
            const topConsumers = [...chartStats.value.consumptionData]
                .sort((a, b) => b.consumption - a.consumption)
                .slice(0, 10);
            
            const data = {
                labels: topConsumers.map(c => c.name.substring(0, 15) + (c.name.length > 15 ? '...' : '')),
                datasets: [{
                    label: 'Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ (Ù…Â³)',
                    data: topConsumers.map(c => c.consumption),
                    backgroundColor: '#00b4d8',
                    borderColor: '#0077b6',
                    borderWidth: 2
                }]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        rtl: true,
                        labels: {
                            font: {
                                family: 'Tajawal',
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        rtl: true,
                        callbacks: {
                            label: (context) => {
                                return `Ø§Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ: ${formatNumber(context.raw)} Ù…Â³`;
                            }
                        }
                    }
                },
                scales: chartTypes.value.consumption !== 'radar' ? {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (value) => formatNumber(value) + ' Ù…Â³'
                        }
                    }
                } : {}
            };
            
            chartInstances.value.consumption = new Chart(ctx, {
                type: chartTypes.value.consumption,
                data: data,
                options: options
            });
        };

        const renderMonthlyChart = () => {
            const ctx = monthlyChart.value?.getContext('2d');
            if (!ctx) return;
            
            const data = {
                labels: monthlyStats.value.months,
                datasets: [
                    {
                        label: 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨',
                        data: monthlyStats.value.revenues,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Ø§Ù„Ù…Ø³Ù„Ù…',
                        data: monthlyStats.value.paid,
                        borderColor: '#00b09b',
                        backgroundColor: 'rgba(0, 176, 155, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    }
                ]
            };
            
            const options = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        rtl: true,
                        labels: {
                            font: {
                                family: 'Tajawal',
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        rtl: true,
                        callbacks: {
                            label: (context) => {
                                return `${context.dataset.label}: ${formatNumber(context.raw)}`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: (value) => formatNumber(value)
                        }
                    }
                }
            };
            
            chartInstances.value.monthly = new Chart(ctx, {
                type: chartTypes.value.monthly,
                data: data,
                options: options
            });
        };

        const renderFullscreenChart = (chartId) => {
            setTimeout(() => {
                let canvas, config;
                
                switch(chartId) {
                    case 'revenue':
                        canvas = revenueChartFullscreen.value;
                        if (chartInstances.value.revenue) {
                            config = chartInstances.value.revenue.config;
                        }
                        break;
                    case 'debt':
                        canvas = debtChartFullscreen.value;
                        if (chartInstances.value.debt) {
                            config = chartInstances.value.debt.config;
                        }
                        break;
                    case 'consumption':
                        canvas = consumptionChartFullscreen.value;
                        if (chartInstances.value.consumption) {
                            config = chartInstances.value.consumption.config;
                        }
                        break;
                    case 'monthly':
                        canvas = monthlyChartFullscreen.value;
                        if (chartInstances.value.monthly) {
                            config = chartInstances.value.monthly.config;
                        }
                        break;
                }
                
                if (canvas && config) {
                    const ctx = canvas.getContext('2d');
                    new Chart(ctx, config);
                }
            }, 100);
        };

        const updateChart = (chartId) => {
            if (chartInstances.value[chartId]) {
                chartInstances.value[chartId].destroy();
            }
            
            switch(chartId) {
                case 'revenue':
                    renderRevenueChart();
                    break;
                case 'debt':
                    renderDebtChart();
                    break;
                case 'consumption':
                    renderConsumptionChart();
                    break;
                case 'monthly':
                    renderMonthlyChart();
                    break;
            }
        };

        // ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
        const exportHighDebtToExcel = () => {
            try {
                const dataForExport = [
                    ['Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¯Ø§Ø¯', 'Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ', 'Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ', 'Ø§Ù„Ù…Ø³Ù„Ù…', 'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨', 'Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©', 'Ø§Ù„Ù‚Ø±ÙŠØ©'],
                    ...highDebtAlerts.value.map(debt => [
                        debt.meterNumber,
                        debt.name,
                        debt.remaining,
                        debt.paid,
                        debt.total,
                        debt.remaining >= 10000 ? 'Ø¹Ø§Ù„ÙŠØ© Ø¬Ø¯Ø§Ù‹' : 'Ø¹Ø§Ù„ÙŠØ©',
                        selectedVillage.value
                    ]),
                    ['', '', '', '', '', '', ''],
                    ['Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©:', '', totalHighDebt.value, '', '', '', ''],
                    ['Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©:', '', highDebtAlerts.value.length, '', '', '', ''],
                    ['Ø£Ø¹Ù„Ù‰ Ù…Ø¯ÙŠÙˆÙ†ÙŠØ©:', '', highestDebtAmount.value, '', '', '', '']
                ];
                
                const ws = XLSX.utils.aoa_to_sheet(dataForExport);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©');
                XLSX.writeFile(wb, `Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª_Ø¹Ø§Ù„ÙŠØ©_${selectedVillage.value}_${selectedMonth.value}.xlsx`);
                
                showSyncIndicator('ØªÙ… ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©:', error);
                showSyncIndicator('ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª', 'error');
            }
        };

        // Ø§Ù„ØªØ­Ø¯Ø« Ø¨ØµÙˆØª
        const speak = (text) => {
            speechSynthesis.cancel(); // Ø¥Ù„ØºØ§Ø¡ Ø£ÙŠ ØµÙˆØª Ù…Ø¹Ù„Ù‚ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ÙÙˆØ±ÙŠØ©
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = "ar-SA";
            msg.rate = 0.85; // Ø³Ø±Ø¹Ø© Ù…ØªØ²Ù†Ø© ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©
            speechSynthesis.speak(msg);
        };

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        const login = () => {
            const user = USERS[password.value];
            if (user) {
                currentUser.value = user;
                isLoggedIn.value = true;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
                updateTimeAndDate();
                
                selectedMonth.value = currentMonth.value;
                
                // ØµÙŠØºØ© Ø§Ù„ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
                const welcomePhrase = `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ø§Ù„Ø£Ø³ØªØ§Ø° ${user.name} ${user.role}ØŒ Ù†Ø¸Ø§Ù… 2026 Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„`;
                
                speak(welcomePhrase);
                
                loadCacheFromStorage();
                loadThemeFromStorage();
                
                loadData();
                showSyncIndicator('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } else {
                showSyncIndicator('ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                password.value = '';
            }
        };

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„ÙƒØ§Ø´
        const cacheData = (village, month, data) => {
            if (!memoryManager.value.enabled) return;
            
            const compressedData = compressData(data);
            
            if (!dataCache.value.villageData[village]) {
                dataCache.value.villageData[village] = {};
            }
            
            dataCache.value.villageData[village][month] = compressedData;
            dataCache.value.lastSynced[`${village}_${month}`] = Date.now();
            memoryManager.value.cacheHits++;
            
            updateMemoryMetadata();
            createBackup(compressedData, `cache_${village}_${month}`);
            
            saveCacheToStorage();
        };

        // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙƒØ§Ø´
        const getCachedData = (village, month) => {
            if (!memoryManager.value.enabled) {
                memoryManager.value.cacheMisses++;
                return null;
            }
            
            if (dataCache.value.villageData[village] && 
                dataCache.value.villageData[village][month]) {
                memoryManager.value.cacheHits++;
                const cachedData = decompressData(dataCache.value.villageData[village][month]);
                
                dataCache.value.lastSynced[`${village}_${month}`] = Date.now();
                saveCacheToStorage();
                
                return cachedData;
            }
            
            memoryManager.value.cacheMisses++;
            return null;
        };

        // Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ø­Ù„ÙŠØ§Ù‹
        const saveChangeLocally = (rowIndex, cellIndex, value, meterNumber) => {
            const key = `${selectedVillage.value}_${selectedMonth.value}`;
            
            if (!dataCache.value.pendingChanges[key]) {
                dataCache.value.pendingChanges[key] = [];
            }
            
            const existingChangeIndex = dataCache.value.pendingChanges[key].findIndex(change => 
                change.row === rowIndex && change.col === cellIndex && !change.synced
            );
            
            if (existingChangeIndex > -1) {
                dataCache.value.pendingChanges[key][existingChangeIndex] = {
                    row: rowIndex,
                    col: cellIndex,
                    value: value,
                    meterNumber: meterNumber,
                    timestamp: Date.now(),
                    synced: false
                };
            } else {
                dataCache.value.pendingChanges[key].push({
                    row: rowIndex,
                    col: cellIndex,
                    value: value,
                    meterNumber: meterNumber,
                    timestamp: Date.now(),
                    synced: false
                });
            }
            
            updatePendingChangesCount();
            saveCacheToStorage();
        };

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const applyPendingChanges = () => {
            const key = `${selectedVillage.value}_${selectedMonth.value}`;
            
            if (dataCache.value.pendingChanges[key]) {
                dataCache.value.pendingChanges[key].forEach(change => {
                    if (villageData.value[change.row] && villageData.value[change.row].length > change.col) {
                        villageData.value[change.row][change.col] = change.value;
                    }
                });
            }
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©
        const hasUnsavedChange = (rowIndex, cellIndex) => {
            const key = `${selectedVillage.value}_${selectedMonth.value}`;
            
            if (dataCache.value.pendingChanges[key]) {
                return dataCache.value.pendingChanges[key].some(change => 
                    change.row === rowIndex && change.col === cellIndex && !change.synced
                );
            }
            return false;
        };

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        const updatePendingChangesCount = () => {
            let total = 0;
            
            for (const key in dataCache.value.pendingChanges) {
                total += dataCache.value.pendingChanges[key].filter(c => !c.synced).length;
            }
            
            pendingChanges.value = total;
        };

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø­Ø³Ù‘Ù†)
        const loadData = async (forceRefresh = false, showLoading = true) => {
            if (showLoading) {
                loading.value = true;
            }
            
            if (villageData.value.length > 0) {
                cacheData(selectedVillage.value, selectedMonth.value, villageData.value);
            }
            
            try {
                const cachedData = getCachedData(selectedVillage.value, selectedMonth.value);
                
                if (cachedData && !forceRefresh) {
                    villageData.value = cachedData;
                    isCachedData.value = true;
                    applyPendingChanges();
                    showSyncIndicator(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© - ${selectedMonth.value}`, 'info');
                    setTimeout(() => refreshDataBackground(), 1000);
                } else {
                    isCachedData.value = false;
                    
                    if (showLoading) {
                        showSmartLoading(
                            'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
                            `Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ${selectedVillage.value} - ${selectedMonth.value}`,
                            'fas fa-cloud-download-alt'
                        );
                        updateSmartLoading(30, 'Ø¬Ø§Ø±Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...');
                    }
                    
                    const url = `${villageAPIs[selectedVillage.value]}?sheet=${encodeURIComponent(selectedMonth.value)}&t=${Date.now()}`;
                    const response = await fetch(url);
                    
                    if (showLoading) updateSmartLoading(70, 'Ø¬Ø§Ø±Ù Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...');
                    const newData = await response.json();
                    villageData.value = newData;
                    applyPendingChanges();
                    cacheData(selectedVillage.value, selectedMonth.value, villageData.value);
                    
                    if (showLoading) updateSmartLoading(100, 'ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­');
                    const monthMsg = selectedMonth.value === currentMonth.value ? ` (Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ)` : '';
                    showSyncIndicator(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª ${selectedVillage.value} - ${selectedMonth.value}${monthMsg}`, 'success');
                }
                
                // ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ AI Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                setTimeout(updateAIStats, 1000);
                
                if (chartsVisible.value) {
                    nextTick(() => {
                        initializeCharts();
                    });
                }
                
                setTimeout(() => autoSyncPendingChanges(), 2000);
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                const cachedData = getCachedData(selectedVillage.value, selectedMonth.value);
                if (cachedData) {
                    villageData.value = cachedData;
                    applyPendingChanges();
                    isCachedData.value = true;
                    showSyncIndicator('Ø¬Ø§Ø±Ù Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø¤Ù‚ØªØ§Ù‹', 'warning');
                } else {
                    showSyncIndicator('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
                }
            } finally {
                if (showLoading) {
                    loading.value = false;
                    setTimeout(() => hideSmartLoading(), 500);
                }
            }
        };

        // ØªØ­Ù…ÙŠÙ„ Ø®Ù„ÙÙŠ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª - Ù…Ø¹Ø¯Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø±
        const refreshDataBackground = async () => {
            try {
                const url = `${villageAPIs[selectedVillage.value]}?sheet=${encodeURIComponent(selectedMonth.value)}&t=${Date.now()}`;
                const response = await fetch(url);
                const freshData = await response.json();
                villageData.value = mergeDataWithChanges(freshData);
                cacheData(selectedVillage.value, selectedMonth.value, villageData.value);
                
                // ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ AI Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„ÙÙŠ
                updateAIStats();
                
                if (chartsVisible.value) {
                    nextTick(() => {
                        initializeCharts();
                    });
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ù„ÙÙŠ:', error);
            }
        };

        // Ø¯Ù…Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        const mergeDataWithChanges = (newData) => {
            const key = `${selectedVillage.value}_${selectedMonth.value}`;
            const mergedData = JSON.parse(JSON.stringify(newData));
            
            if (dataCache.value.pendingChanges[key]) {
                dataCache.value.pendingChanges[key].forEach(change => {
                    if (mergedData[change.row] && mergedData[change.row].length > change.col) {
                        mergedData[change.row][change.col] = change.value;
                    }
                });
            }
            
            return mergedData;
        };

        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù‚Ø±Ù‰
        const onVillageChange = () => {
            const key = `${selectedVillage.value}_${selectedMonth.value}`;
            const hasChanges = checkForPendingChanges();
            
            if (hasChanges) {
                if (confirm('Ù‡Ù†Ø§Ùƒ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ØŸ')) {
                    showSmartLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„', 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...');
                    loadData();
                } else {
                    selectedVillage.value = selectedVillage.value;
                    return;
                }
            } else {
                showSmartLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„', 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©...');
                loadData();
            }
        };

        // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ø´Ù‡Ø±
        const onMonthChange = () => {
            const key = `${selectedVillage.value}_${selectedMonth.value}`;
            const hasChanges = checkForPendingChanges();
            
            if (hasChanges) {
                if (confirm('Ù‡Ù†Ø§Ùƒ ØªØºÙŠÙŠØ±Ø§Øª ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ØŸ')) {
                    showSmartLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„', 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯...');
                    loadData();
                } else {
                    selectedMonth.value = selectedMonth.value;
                    return;
                }
            } else {
                showSmartLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ¨Ø¯ÙŠÙ„', 'Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯...');
                loadData();
            }
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©
        const checkForPendingChanges = () => {
            const key = `${selectedVillage.value}_${selectedMonth.value}`;
            return dataCache.value.pendingChanges[key] && 
                   dataCache.value.pendingChanges[key].some(c => !c.synced);
        };

        // Ø­ÙØ¸ Ø§Ù„Ø®Ù„ÙŠØ© Ù…Ø¹ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø°ÙƒÙŠØ©
        const saveCell = async (event, rowIndex, cellIndex, meterNumber) => {
            const newValue = event.target.textContent.trim();
            const oldValue = villageData.value[rowIndex][cellIndex];
            
            if (newValue === oldValue) return;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            if (!currentUser.value.permissions || !currentUser.value.permissions.canEdit.includes(cellIndex)) {
                showSyncIndicator('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙˆØ¯', 'error');
                event.target.textContent = oldValue;
                return;
            }
            
            if ([3, 10, 11].includes(cellIndex)) {
                if (isNaN(parseFloat(newValue)) && newValue !== '') {
                    showSyncIndicator('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­', 'error');
                    event.target.textContent = oldValue;
                    return;
                }
            }
            
            villageData.value[rowIndex][cellIndex] = newValue;
            saveChangeLocally(rowIndex, cellIndex, newValue, meterNumber);
            savingCells.value.push({ row: rowIndex, col: cellIndex });
            
            try {
                if (isOnline.value) {
                    await syncCell(rowIndex, cellIndex, newValue, meterNumber);
                    markChangeAsSynced(rowIndex, cellIndex);
                    lastSyncTime.value = new Date().toLocaleTimeString('ar-SA');
                    savedCells.value.push({ row: rowIndex, col: cellIndex });
                    
                    setTimeout(() => {
                        const index = savedCells.value.findIndex(cell => 
                            cell.row === rowIndex && cell.col === cellIndex
                        );
                        if (index > -1) savedCells.value.splice(index, 1);
                    }, 1000);
                    
                    // ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ AI Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸
                    setTimeout(updateAIStats, 500);
                    
                    if (chartsVisible.value) {
                        nextTick(() => {
                            initializeCharts();
                        });
                    }
                    
                } else {
                    showSyncIndicator('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ø³ÙŠØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„', 'warning');
                }
                
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©:', error);
                showSyncIndicator('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ø­Ù„ÙŠØ§Ù‹ØŒ Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©', 'warning');
            } finally {
                const index = savingCells.value.findIndex(cell => 
                    cell.row === rowIndex && cell.col === cellIndex
                );
                if (index > -1) savingCells.value.splice(index, 1);
            }
        };

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø®Ù„ÙŠØ© ÙˆØ§Ø­Ø¯Ø©
        const syncCell = async (rowIndex, cellIndex, value, meterNumber) => {
            if (!isOnline.value) {
                throw new Error('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª');
            }
            
            const columnLetters = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N'];
            const columnLetter = columnLetters[cellIndex];
            const sheetRow = rowIndex + 1;
            
            const formData = new FormData();
            formData.append('sheet', selectedMonth.value);
            formData.append('row', sheetRow.toString());
            formData.append('col', columnLetter);
            formData.append('value', value);
            formData.append('meterNumber', meterNumber);
            formData.append('village', selectedVillage.value);
            formData.append('timestamp', Date.now().toString());
            
            isSyncing.value = true;
            
            try {
                await fetch(villageAPIs[selectedVillage.value], {
                    method: 'POST',
                    body: formData,
                    mode: 'no-cors'
                });
                
                return true;
            } catch (error) {
                throw error;
            } finally {
                isSyncing.value = false;
            }
        };

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        const syncAllChanges = async () => {
            if (!isOnline.value) {
                showSyncIndicator('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'error');
                return;
            }
            
            if (pendingChanges.value === 0) {
                showSyncIndicator('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø©', 'info');
                return;
            }
            
            showSmartLoading('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©', `Ø¬Ø§Ø±Ù Ù…Ø²Ø§Ù…Ù†Ø© ${pendingChanges.value} ØªØºÙŠÙŠØ±...`);
            updateSmartLoading(10, 'Ø¬Ù…Ø¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª...');
            
            let syncedCount = 0;
            let errorCount = 0;
            
            for (const key in dataCache.value.pendingChanges) {
                const [village, month] = key.split('_');
                const changes = dataCache.value.pendingChanges[key];
                
                if (changes && changes.length > 0) {
                    updateSmartLoading(
                        30 + (syncedCount / pendingChanges.value * 50),
                        `Ø¬Ø§Ø±Ù Ù…Ø²Ø§Ù…Ù†Ø© ØªØºÙŠÙŠØ±Ø§Øª ${village} - ${month}...`
                    );
                    
                    for (const change of changes) {
                        if (!change.synced) {
                            try {
                                const currentVillage = selectedVillage.value;
                                const currentMonth = selectedMonth.value;
                                
                                selectedVillage.value = village;
                                selectedMonth.value = month;
                                
                                await syncCell(change.row, change.col, change.value, change.meterNumber);
                                
                                selectedVillage.value = currentVillage;
                                selectedMonth.value = currentMonth;
                                
                                change.synced = true;
                                syncedCount++;
                                
                                updateSmartLoading(
                                    30 + (syncedCount / pendingChanges.value * 50),
                                    `ØªÙ… Ù…Ø²Ø§Ù…Ù†Ø© ${syncedCount} Ù…Ù† ${pendingChanges.value} ØªØºÙŠÙŠØ±`
                                );
                                
                            } catch (error) {
                                console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªØºÙŠÙŠØ±:', error);
                                errorCount++;
                            }
                        }
                    }
                }
            }
            
            updatePendingChangesCount();
            updateSmartLoading(100, 'Ø§ÙƒØªÙ…Ù„Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©');
            
            setTimeout(() => {
                hideSmartLoading();
                
                if (errorCount === 0) {
                    showSyncIndicator(`ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© ${syncedCount} ØªØºÙŠÙŠØ± Ø¨Ù†Ø¬Ø§Ø­`, 'success');
                } else {
                    showSyncIndicator(`ØªÙ…Øª Ù…Ø²Ø§Ù…Ù†Ø© ${syncedCount} ØªØºÙŠÙŠØ±ØŒ ÙØ´Ù„ ${errorCount}`, 'warning');
                }
                
                // ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ AI Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
                setTimeout(updateAIStats, 500);
                
                if (chartsVisible.value) {
                    nextTick(() => {
                        initializeCharts();
                    });
                }
                
                loadData(false, false);
            }, 1000);
        };

        // Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª
        const autoSyncPendingChanges = async () => {
            if (!isOnline.value || isSyncing.value || pendingChanges.value === 0) return;
            if (pendingChanges.value <= 5) {
                await syncAllChanges();
            }
        };

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ù„ÙÙŠØ© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© Ø¨Ø¯ÙˆÙ† Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø¤Ø´Ø±
        setInterval(() => {
            if (isLoggedIn.value && isOnline.value && !loading.value && !isSyncing.value) {
                refreshDataBackground();
            }
        }, 30000);

        // Ù…Ø²Ø§Ù…Ù†Ø© ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§ØªØµØ§Ù„
        setInterval(() => {
            if (isLoggedIn.value && isOnline.value && pendingChanges.value > 0) {
                autoSyncPendingChanges();
            }
        }, 60000);

        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
        setInterval(() => {
            if (isLoggedIn.value && memoryManager.value.enabled) {
                optimizeMemory();
            }
        }, memoryManager.value.cleanupInterval);
        
        // ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ AI ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚ØªÙŠÙ†
        setInterval(() => {
            if (isLoggedIn.value && villageData.value.length > 0) {
                updateAIStats();
            }
        }, 120000);

        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØªØºÙŠÙŠØ± ÙƒÙ…ØªÙ… Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©
        const markChangeAsSynced = (rowIndex, cellIndex) => {
            const key = `${selectedVillage.value}_${selectedMonth.value}`;
            
            if (dataCache.value.pendingChanges[key]) {
                const change = dataCache.value.pendingChanges[key].find(c => 
                    c.row === rowIndex && c.col === cellIndex && !c.synced
                );
                
                if (change) {
                    change.synced = true;
                    updatePendingChangesCount();
                    saveCacheToStorage();
                }
            }
        };

        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
        const createBackup = (data, context) => {
            const backup = {
                data: JSON.parse(JSON.stringify(data)),
                timestamp: Date.now(),
                context: context,
                village: selectedVillage.value,
                month: selectedMonth.value
            };
            
            dataCache.value.backup[Date.now()] = backup;
            
            if (backupHistory.value.length >= 10) {
                backupHistory.value.shift();
            }
            backupHistory.value.push(backup);
            
            saveCacheToStorage();
        };

        // Ø¬Ù„Ø¨ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„
        const filteredDataWithTotal = computed(() => {
            const data = villageData.value;
            
            if (!data || data.length === 0) return [];
            
            const filteredData = [...data];
            
            if (searchQuery.value) {
                return filteredData.filter((row, index) => {
                    if (index === 0 || index === 1 || index === data.length - 1) return true;
                    
                    return row.some(cell => 
                        String(cell).toLowerCase().includes(searchQuery.value.toLowerCase())
                    );
                });
            }
            
            return filteredData;
        });

        // ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        const exportToExcel = () => {
            try {
                const dataForExport = villageData.value.map(row => [...row]);
                const ws = XLSX.utils.aoa_to_sheet(dataForExport);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, selectedMonth.value);
                XLSX.writeFile(wb, `${selectedVillage.value}_${selectedMonth.value}.xlsx`);
                
                showSyncIndicator('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØµØ¯ÙŠØ±:', error);
                showSyncIndicator('ÙØ´Ù„ ÙÙŠ ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'error');
            }
        };

        // Ø§Ù„Ø®Ø±ÙˆØ¬
        const logout = () => {
            isLoggedIn.value = false;
            currentUser.value = {};
            password.value = '';
            villageData.value = [];
            showSyncIndicator('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'info');
        };

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„ØµÙÙˆÙ
        const getRowClass = (rowIndex, row) => {
            if (rowIndex === 0) return 'row-0';
            if (rowIndex === 1) return 'row-1';
            if (rowIndex === villageData.value.length - 1) return 'total-row';
            return '';
        };

        const canEdit = (rowIndex, cellIndex, row) => {
            if (!currentUser.value.permissions) return false;
            if (rowIndex === 0 || rowIndex === 1 || rowIndex === villageData.value.length - 1) return false;
            return currentUser.value.permissions.canEdit.includes(cellIndex);
        };

        const isSaving = (rowIndex, cellIndex) => {
            return savingCells.value.some(cell => cell.row === rowIndex && cell.col === cellIndex);
        };

        const isSaved = (rowIndex, cellIndex) => {
            return savedCells.value.some(cell => cell.row === rowIndex && cell.col === cellIndex);
        };

        const getCellTitle = (rowIndex, cellIndex, row) => {
            if (cellIndex === 12 && row[cellIndex] >= 5000) {
                return 'Ù…Ø¯ÙŠÙˆÙ†ÙŠØ© Ø¹Ø§Ù„ÙŠØ©! ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© ÙÙˆØ±ÙŠØ©';
            }
            if (canEdit(rowIndex, cellIndex, row)) {
                return 'Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ - Ø§Ù†Ù‚Ø± Ù†Ù‚Ø±Ø§Ù‹ Ù…Ø²Ø¯ÙˆØ¬Ø§Ù‹ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„';
            }
            return '';
        };

        // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© Ù„Ù„ÙˆØµÙˆÙ„
        const totalRevenue = computed(() => chartStats.value.totalRevenue);
        const totalPaid = computed(() => chartStats.value.totalPaid);
        const totalRemaining = computed(() => chartStats.value.totalRemaining);
        const highDebtCount = computed(() => chartStats.value.highDebtCount);
        const mediumDebtCount = computed(() => chartStats.value.mediumDebtCount);
        const lowDebtCount = computed(() => chartStats.value.lowDebtCount);
        const averageConsumption = computed(() => chartStats.value.averageConsumption);
        const highestConsumption = computed(() => chartStats.value.highestConsumption);
        const lowestConsumption = computed(() => chartStats.value.lowestConsumption);
        const bestMonth = computed(() => monthlyStats.value.bestMonth);
        const bestMonthRevenue = computed(() => monthlyStats.value.bestMonthRevenue);

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù…
        onMounted(() => {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            updateTimeAndDate();
            
            // ØªØ­Ø¯ÙŠØ« Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
            window.addEventListener('online', () => {
                isOnline.value = true;
                showSyncIndicator('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'success');
                autoSyncPendingChanges();
            });
            
            window.addEventListener('offline', () => {
                isOnline.value = false;
                showSyncIndicator('ÙÙ‚Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'error');
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø¥Ø°Ø§ ØªÙ… ÙØªØ­Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹
            if (showMonthlyReport.value) {
                fetchMonthlyReportData();
            }
            
            // ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ AI ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
            setInterval(() => {
                if (isLoggedIn.value && villageData.value.length > 0) {
                    updateAIStats();
                }
            }, 300000);
        });

        // Ù…ØªØ§Ø¨Ø¹Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„Ø¨Ø­Ø«
        watch(searchQuery, () => {
            if (searchQuery.value) {
                executeSmartSearch();
            }
        });

        // Ù…ØªØ§Ø¨Ø¹Ø© ØªØºÙŠÙŠØ±Ø§Øª Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
        watch(currentReportMonth, () => {
            if (currentReportMonth.value && monthlyReportData.value[currentReportMonth.value]) {
                // Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙÙ‚Ø· ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            }
        });

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        onMounted(() => {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
            updateTimeAndDate();
            
            // ØªØ­Ø¯ÙŠØ« Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª
            window.addEventListener('online', () => {
                isOnline.value = true;
                showSyncIndicator('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'success');
                autoSyncPendingChanges();
            });
            
            window.addEventListener('offline', () => {
                isOnline.value = false;
                showSyncIndicator('ÙÙ‚Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'error');
            });
            
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ø¥Ø°Ø§ ØªÙ… ÙØªØ­Ù‡ Ù…Ø³Ø¨Ù‚Ø§Ù‹
            if (showMonthlyReport.value) {
                fetchMonthlyReportData();
            }
            
            // ØªØ­Ø¯ÙŠØ« ØªØ­Ù„ÙŠÙ„ AI ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
            setInterval(() => {
                if (isLoggedIn.value && villageData.value.length > 0) {
                    updateAIStats();
                }
            }, 300000);
        });

        return {
            // Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            isLoggedIn,
            password,
            currentUser,
            loading,
            searchQuery,
            villageData,
            selectedVillage,
            selectedMonth,
            isSyncing,
            isOnline,
            lastSyncTime,
            showAlertsModal,
            showMemoryManagement,
            showMonthlyReport,
            time,
            todayDate,
            todayDay,
            
            // Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
            chartsVisible,
            aiPanelVisible,
            fullscreenChartId,
            chartTypes,
            
            // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
            showSearchResults,
            isRecording,
            smartSearchResults,
            
            // Ø§Ù„ÙˆØ¶Ø¹
            currentTheme,
            focusMode,
            
            // Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            memoryStats,
            pendingChanges,
            
            // Ù…Ø¤Ø´Ø±Ø§Øª
            syncIndicator,
            smartLoading,
            
            // AI
            aiStats,
            aiRecommendations,
            aiAlerts,
            aiStatus,
            
            // Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
            monthlyReportData,
            monthlyReportLoading,
            monthlyReportSearchTerm,
            currentReportMonth,
            monthlyReportLastUpdated,
            monthlyReportStats,
            monthlyReportHeaders,
            filteredMonthlyReportRows,
            
            // Ø§Ù„Ù…Ø¯ÙŠÙˆÙ†ÙŠØ§Øª Ø§Ù„Ø¹Ø§Ù„ÙŠØ©
            highDebtAlerts,
            totalHighDebt,
            highestDebtAmount,
            
            // Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø³ÙˆÙ…
            totalRevenue,
            totalPaid,
            totalRemaining,
            highDebtCount,
            mediumDebtCount,
            lowDebtCount,
            averageConsumption,
            highestConsumption,
            lowestConsumption,
            bestMonth,
            bestMonthRevenue,
            
            // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØµÙØ§Ø©
            filteredDataWithTotal,
            
            // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø°ÙƒÙŠ
            executeSmartSearch,
            startVoiceRecognition,
            getDebtLevelClass,
            scrollToRow,
            
            // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ¶Ø¹
            changeTheme,
            toggleFocusMode,
            loadThemeFromStorage,
            
            // Ø¯ÙˆØ§Ù„ AI
            refreshAIAnalysis,
            toggleAIPanel,
            toggleCharts,
            generateAIReport,
            showDebtAnalysis,
            showRevenueAnalysis,
            showConsumptionAnalysis,
            showRiskAnalysis,
            showAIInsights,
            
            // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ
            fetchMonthlyReportData,
            getReportCellClass,
            formatReportCell,
            
            // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
            optimizeMemory,
            clearMemoryCache,
            
            // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
            initializeCharts,
            updateChart,
            fullscreenChart,
            closeFullscreen,
            
            // Ø§Ù„Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            login,
            logout,
            onVillageChange,
            onMonthChange,
            saveCell,
            syncAllChanges,
            exportToExcel,
            exportHighDebtToExcel,
            
            // Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¬Ø¯ÙˆÙ„
            getRowClass,
            canEdit,
            isHighDebtCell,
            hasHighDebt,
            isSaving,
            isSaved,
            hasUnsavedChange,
            getCellTitle,
            
            // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
            formatNumber,
            formatTimeAgo,
            
                       // Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹
            revenueChart,
            debtChart,
            consumptionChart,
            monthlyChart,
            revenueChartFullscreen,
            debtChartFullscreen,
            consumptionChartFullscreen,
            monthlyChartFullscreen
        };
    }
}).mount('#app');
</script>

<style>
    #waterInstallBtn {
        position: fixed;
        bottom: 30px;
        left: 30px;
        background: linear-gradient(135deg, #4cc9f0, #03045e);
        color: white;
        padding: 12px 25px;
        border-radius: 50px;
        border: none;
        font-family: 'Tajawal', sans-serif;
        font-weight: bold;
        font-size: 14px;
        cursor: pointer;
        z-index: 9999;
        box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        display: none;
        align-items: center;
        gap: 8px;
        transition: all 0.3s;
    }
    
    #waterInstallBtn:hover {
        transform: scale(1.05);
        box-shadow: 0 8px 20px rgba(0,0,0,0.4);
    }
</style>

<button id="waterInstallBtn">
    <i class="fas fa-download"></i> ØªØ«Ø¨ÙŠØª ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ
</button>

<script>
// 1. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ù„Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
            .then(reg => console.log('âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª'))
            .catch(err => console.log('âŒ ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ SW', err));
    });
}

// 2. Ù…Ù†Ø·Ù‚ Ø²Ø± Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ÙŠØ¯ÙˆÙŠ ÙˆØ§Ù„Ù€ PWA
let deferredPrompt;
document.addEventListener('DOMContentLoaded', function() {
    const installBtn = document.getElementById('waterInstallBtn');

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ 10 Ø«ÙˆØ§Ù†Ù Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ«Ø¨ÙŠØª
        setTimeout(() => {
            if (installBtn) installBtn.style.display = 'flex';
        }, 10000);
    });

    if (installBtn) {
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') installBtn.style.display = 'none';
                deferredPrompt = null;
            } else {
                // Ø±Ø³Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¢ÙŠÙÙˆÙ† Ø£Ùˆ ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø¯Ø¹Ù… Ø§Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                let msg = isIOS 
                    ? 'ğŸ“± Ù„Ù„Ù€ iPhone:\n Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "Ù…Ø´Ø§Ø±ÙƒØ©" Ø«Ù… "Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©".' 
                    : 'âš™ï¸ Ù„Ù„ØªØ«Ø¨ÙŠØª:\n Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (â‹®) Ø«Ù… Ø§Ø®ØªØ± "ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚".';
                alert('ğŸ¯ Ù†Ø¸Ø§Ù… Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ:\n\n' + msg);
            }
        });
    }
});

// 3. Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ Manifest Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ù…Ø¹ Ø£ÙŠÙ‚ÙˆÙ†Ø© "Ø§Ù„Ù‚Ø·Ø±Ø© Ø§Ù„Ø²Ø±Ù‚Ø§Ø¡"
try {
    const iconSVG = "data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%23030814'/><text x='50' y='65' font-size='40' text-anchor='middle' fill='%234cc9f0'>ğŸ’§</text></svg>";
    const manifest = {
        "name": "Ù†Ø¸Ø§Ù… Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ",
        "short_name": "Ø§Ù„Ø³ÙˆÙØ¹ÙŠ",
        "description": "Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ÙŠØ§Ù‡ Ø§Ù„Ø³ÙˆÙØ¹ÙŠ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„",
        "start_url": ".",
        "display": "standalone",
        "background_color": "#000814",
        "theme_color": "#4cc9f0",
        "icons": [
            { "src": iconSVG, "sizes": "192x192", "type": "image/svg+xml" },
            { "src": iconSVG, "sizes": "512x512", "type": "image/svg+xml" }
        ]
    };
    const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
    const manifestURL = URL.createObjectURL(manifestBlob);
    const link = document.createElement('link');
    link.rel = 'manifest';
    link.href = manifestURL;
    document.head.appendChild(link);
} catch(e) {
    console.error('Manifest Error');
}
</script>

</body>
</html>
